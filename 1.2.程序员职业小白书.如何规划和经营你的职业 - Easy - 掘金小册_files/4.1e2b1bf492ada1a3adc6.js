webpackJsonp([4],{1e3:function(t,e,n){t.exports=n.p+"static/img/wx-pay.6a911dc.svg"},1001:function(t,e,n){function i(t){n(1002)}var s=n(25)(n(1003),n(1008),i,"data-v-6692af02",null);t.exports=s.exports},1002:function(t,e){},1003:function(t,e,n){"use strict";function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{hasSale:!1,realityPrice:null,code:"",discountRate:null};return{hasSale:t.hasSale,realityPrice:t.realityPrice,code:t.code,discountRate:t.discountRate}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1004),o=n.n(s),r=n(215);e.default={props:["info","payWay"],components:{Conpon:o.a},data:function(){return{aliPay:r.a,visibleConpon:!1,saleInfo:i()}},computed:{saleText:function(){var t=this.saleInfo.discountRate;return t>0?this.saleInfo.discountRate+"折":"免费"}},methods:{computeSale:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.visibleConpon=!1;var n=.01,s=isNaN(e)?1:10*e/100,o=s*this.info.price;0===o?n=0:(o=parseInt(100*o)/100,n=o>0?o.toFixed(2):.01),this.saleInfo=i({code:t,hasSale:!0,discountRate:e,realityPrice:n})},resetSaleInfo:function(){this.visibleConpon=!1,this.saleInfo=i({realityPrice:this.info.price})},close:function(){this.$emit("close")},next:function(){var t=this,e=this.saleInfo;e.hasSale;e.realityPrice>0?this.$emit("next",this.saleInfo.code):(this.$getBean("xiaoceBusiness").storagePaymengtStatus(this.payWay),this.$getBean("xiaoceBusiness").freeDiscount({metaId:this.info.id,type:this.payWay,code:this.saleInfo.code||""}).then(function(e){window.location.href="/book/"+t.info.id+"?paymentStatus="+t.payWay}))}},mounted:function(){this.saleInfo=i({realityPrice:this.info.price})}}},1004:function(t,e,n){function i(t){n(1005)}var s=n(25)(n(1006),n(1007),i,"data-v-bb1b3500",null);t.exports=s.exports},1005:function(t,e){},1006:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(37);e.default={data:function(){return{inputStatus:"",code:"",errorMsg:""}},props:["id"],computed:{isMobileBrowser:function(){return Object(i.d)()},conponClass:function(){return this.isMobileBrowser?"conpon-inner--"+this.inputStatus:""}},methods:{conponFocus:function(){this.inputStatus="focus"},conponBlur:function(){this.inputStatus="blur"},cancel:function(){this.$emit("close")},check:function(){var t=this,e=this.code.trim();this.$getBean("xiaoceBusiness").checkDiscount({metaId:this.id,code:e}).then(function(e){if(e.isOk){var n=e.discountRate;t.$emit("submit",t.code,n)}else t.errorMsg=e.message||"优惠码错误，请重新输入"})}},mounted:function(){this.$refs.saleInput.focus()}}},1007:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"conpon-wrap"},[n("div",{staticClass:"conpon-masker"}),n("div",{staticClass:"conpon-inner",class:t.conponClass},[n("div",{staticClass:"heading"},[t._v("请输入优惠码")]),n("div",{staticClass:"content"},[n("div",{staticClass:"conpon-input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.code,expression:"code"}],ref:"saleInput",attrs:{autofocus:"autofocus"},domProps:{value:t.code},on:{focus:t.conponFocus,blur:t.conponBlur,keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.check(e)},input:function(e){e.target.composing||(t.code=e.target.value)}}}),t.errorMsg?n("div",{staticClass:"state-text"},[t._v(t._s(t.errorMsg))]):t._e()])]),n("div",{staticClass:"footer"},[n("div",{staticClass:"btn cancel",on:{click:t.cancel}},[t._v("取消")]),n("div",{staticClass:"btn ok",on:{click:t.check}},[t._v("确定")])])])])},staticRenderFns:[]}},1008:function(t,e,n){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"payment-dialog"},[i("div",{staticClass:"cell"},[i("span",{staticClass:"close-btn",on:{click:t.close}}),i("div",{staticClass:"title"},[t._v(t._s(t.info.title))]),i("div",{staticClass:"price"},[i("span",{staticClass:"name"},[t._v("支付总额")]),t.saleInfo.hasSale?i("div",{staticClass:"price-sale"},[i("div",{staticClass:"span rmb"},[t._v("￥"+t._s(t.saleInfo.realityPrice))]),i("div",{staticClass:"span delete"},[t._v("￥"+t._s(t.info.price))])]):i("div",{staticClass:"price-default"},[i("div",{staticClass:"span rmb"},[t._v("￥"+t._s(t.info.price))])])]),i("div",{staticClass:"pay-way"},[i("span",{staticClass:"name"},[t._v("支付方式")]),t.payWay===t.aliPay?i("span",{staticClass:"ali-pay"},[i("img",{attrs:{src:n(1009)}}),t._v("支付宝支付")]):i("span",{staticClass:"wx-pay"},[i("img",{attrs:{src:n(1010)}})])]),i("div",{staticClass:"pay-sale",on:{click:function(e){t.visibleConpon=!0}}},[i("span",{staticClass:"name"},[t._v("使用优惠码")]),t.saleInfo.hasSale?t._e():i("span",{staticClass:"not-sale"},[t._v("输入优惠码")]),t.saleInfo.hasSale?i("span",{staticClass:"sale-box",on:{click:function(e){t.visibleConpon=!0}}},[t._v(t._s(t.saleText))]):t._e()]),i("div",{staticClass:"pay-bar"},[i("button",{staticClass:"button--buy",on:{click:t.next}},[t._v("确认支付")])])]),t.visibleConpon?i("conpon",{attrs:{id:t.info.id},on:{close:t.resetSaleInfo,submit:t.computeSale}}):t._e()],1)},staticRenderFns:[]}},1009:function(t,e,n){t.exports=n.p+"static/img/ali-pay-logo.a251946.png"},1010:function(t,e,n){t.exports=n.p+"static/img/wx-pay-logo.2a9abb4.png"},1011:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.show?n("div",{staticClass:"payment-wrap"},[n("div",{staticClass:"payment-masker"}),n("div",{staticClass:"payment-inner"},[n("transition",{attrs:{name:"fade",mode:"out-in"}},[n(t.paymentStep,{tag:"component",attrs:{info:t.info,"pay-way":t.payWay},on:{close:t.close,prev:t.prev,next:t.next}})],1)],1)]):t._e()},staticRenderFns:[]}},1327:function(t,e){},1328:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n.n(i),o=n(149),r=n.n(o),a=n(56),c=n(9),u=n(87),l=n(216),f=n.n(l),d=n(1329),h=n.n(d),m=n(937),p=n.n(m),v=n(1335),g=n.n(v),y=n(1342),b=n.n(y),C=n(987),_=n.n(C),k=n(993),w=n.n(k),x=n(1346),I=n.n(x),L=n(1355),S=n.n(L);e.default={components:{UserAuth:S.a,BookDirectory:I.a,BookDirection:g.a,BookProgress:b.a,WechatQuickLogin:_.a,BookPaymentPopup:w.a,SectionPrev:h.a,SectionNext:h.a},data:function(){return{sectionList:[],commentList:[],bookInfo:null,sectionInfo:{},direction:"next",view:"prev",unfoldM:!1,foldPc:!1,isViewNavOnTop:!1,isHeaderVisible:!0,needHide:!1,postId:""}},computed:r()({},Object(u.mapGetters)({user:c.USER,logined:c.LOGINED}),{isAdmin:function(){var t=this.user||{},e="admin"===t.role,n=this.author.uid===t.id;return e||n},isXiaoceAuthor:function(){var t=this.user||{},e="admin"===t.role;return t.isXiaoceAuthor||e},canPayment:function(){var t=this.bookInfo,e=t.price,n=t.isBuy,i=t.isEditor;return e>0&&!n&&!i},directionClass:function(){return"prev"===this.direction?"transition--prev":"transition--next"},bookId:function(){return this.$route.params.id},sectionId:function(){return this.$route.params.sectionId},filterList:function(){var t=this;return this.isAdmin?this.sectionList.map(function(t){return t.sectionId}).filter(function(t){return t}):this.sectionList.map(function(e){return!(!t.free&&!e.isFree||!e.isFinished)&&e.sectionId}).filter(function(t){return t})},sectionIdList:function(){return this.bookInfo&&this.bookInfo.section||[]},curDirectoryIndex:function(){return this.sectionIdList&&this.sectionIdList.indexOf(this.sectionId)},curFreeDirectoryIndex:function(){var t=this.$route.params.sectionId;return this.filterList.indexOf(t)},free:function(){var t=this.bookInfo,e=t.price,n=t.isBuy,i=t.isEditor;return 0===e||n||i},author:function(){var t=this.bookInfo;return t&&t.user||{}}}),watch:{$route:function(){this.bookInfo||this.fetch(),this.getSection(),this.loopComponent()}},shareInfo:function(){var t=this.bookInfo||{};return{title:t.title+" - "+this.author.username+" - 掘金小册",noTemplate:!0,description:t.desc,thumb:t.img,url:this.$route.fullPath}},metaInfo:function(){var t=this.bookInfo&&this.bookInfo.title||"",e=this.author.username||"";return t=t?t+" - ":"",e=e?e+" - ":"",{titleTemplate:null,title:""+t+e+"掘金小册"}},methods:r()({},Object(u.mapActions)({toogle_suspension:c.CHANGE_SUSPENSION_PANEL}),{verifyBuyBook:function(){if(this.logined)this.buyBook();else{var t=this.$getBean("eventBus");t.emit(t.eventType.AUTH_WECHAT_QUICK_LOGIN)}},buyBook:function(){var t=this.$getBean("eventBus"),e=this.bookInfo,n=e.id,i=e.title,s=e.price;t.emit(t.eventType.BOOK_PAYMENT,{id:n,title:i,price:s})},buyBookForDirection:function(){this.verifyBuyBook()},initImageViewer:function(){var t=this;this.imageViewer&&this.imageViewer.destroy(),this.imageViewer=new f.a(this.$refs.bookBody,{urlHandler:function(t){return t.split("?")[0]+"?imageslim"},targetClassName:"loaded",backgroundColor:"rgba(0,0,0,.65)"}),this.removeScrollListener=Object(a.e)(document,function(e){t.imageViewer.hide()})},getXiaoce:function(){this.getXiaoceById()},getXiaoceById:function(){var t=this;return this.$getBean("xiaoceBusiness").getXiaoceById(this.bookId).then(function(e){t.bookInfo=e,t.getListSection()})},getListSection:function(){var t=this;this.$getBean("xiaoceBusiness").getListSection(this.bookId).then(function(e){t.sectionList=e.map(function(t){return s()(t,{read:!1})}),t.sectionId?t.getSection():t.redirectSection()})},getSection:function(){var t=this,e=this.sectionId;this.setSectionListIsRead(e),this.$getBean("xiaoceBusiness").getXiaoceSection(e).then(function(e){var n=t.$getBean("articleBusiness");t.sectionInfo=s()({},e,{html:n.processArticleHtml(e.html,{lazyload:!0})}),t.$nextTick(function(){t.initImageViewer(),t.initLazyload()})}).catch(function(e){t.$router.push({name:"bookInfo",params:{id:t.bookId}})})},initLazyload:function(){var t=this;setTimeout(function(){var e=t.$refs.bookBody.getElementsByTagName("img");t.lazyload=new p.a(e,{threshold:200,debounce:!0,eagerShowing:!0,infoGetter:function(t){var e=t.getAttribute("data-src");if(e)return{url:e,width:t.getAttribute("data-width"),height:t.getAttribute("data-height")}}})})},setFreeSection:function(t,e){var n=this;this.$getBean("xiaoceBusiness").setFreeSection(t,e).then(function(t){n.getListSection()}).catch(function(t){n.$alert(t)})},redirectSection:function(){var t=this.filterList&&this.filterList[0];t?(this.setSectionListIsRead(t),this.$router.push({params:{id:this.bookId,sectionId:t}})):this.$router.push({name:"bookInfo",params:{id:this.bookId}})},loopComponent:function(){var t=this.view;this.view="prev"===t?"next":"prev"},prevPage:function(t){(t=t||this.filterList[this.curFreeDirectoryIndex-1])&&(this.setSectionListIsRead(t),this.sectionInfo.html="",this.direction="prev",this.$router.push({params:{sectionId:t}}))},nextPage:function(t){(t=t||this.filterList[this.curFreeDirectoryIndex+1])&&(this.setSectionListIsRead(t),this.direction="next",this.sectionInfo.html="",this.$router.push({params:{sectionId:t}}))},setSectionIsRead:function(t,e){var n=s()(this.sectionList[t],{read:e});this.$set(this.sectionList,t,n)},setSectionListIsRead:function(t,e){var n=this,i=this.sectionIdList.indexOf(t);e=!!e,i>-1&&this.sectionIdList.forEach(function(t,e){e<i?n.setSectionIsRead(e,!0):n.setSectionIsRead(e,!1)})},linkSection:function(t){var e=this.sectionIdList.indexOf(t);this.curDirectoryIndex>e?(this.direction="prev",this.prevPage(t)):(this.direction="next",this.nextPage(t)),this.unfoldM=!1},toggleSummary:function(){var t=this.unfoldM,e=this.foldPc;this.unfoldM=!t,this.foldPc=!e},fetch:function(){this.getXiaoce()},reset:function(){this.toogle_suspension(!0)}}),preFetch:function(t){},mounted:function(){var t=this;this.removeDirectionListener=function(){},this.removeScrollListener=function(){},this.removeScrollDirectionChangeEventListener=Object(a.g)(window,function(e,n){var i="up"===e,s=n<=50;t.needHide=s&&!i,t.isHeaderVisible=s||i},50),this.removeScrollEventListener=Object(a.e)(window,function(){window.pageYOffset<=50&&!t.isHeaderVisible?t.isHeaderVisible=!0:t.needHide&&(t.needHide=!1,t.isHeaderVisible=!1)},50),this.toogle_suspension(!1),this.fetch(),this.removeDirectionListener=Object(a.c)(document,"keyup",function(e){37===e.keyCode?t.prevPage():39===e.keyCode&&t.nextPage()})},beforeDestroy:function(){this.reset(),this.imageViewer&&this.imageViewer.destroy(),this.removeScrollListener(),this.removeDirectionListener(),this.removeScrollEventListener(),this.removeScrollDirectionChangeEventListener()}}},1329:function(t,e,n){function i(t){n(1330),n(1331),n(1332)}var s=n(25)(n(1333),n(1334),i,"data-v-61dfa6ed",null);t.exports=s.exports},1330:function(t,e){},1331:function(t,e){},1332:function(t,e){},1333:function(t,e,n){"use strict";function i(t){if(t.length){return t.map(function(t){return t.createdAt}).sort(function(t,e){return t-e})[0]}return null}Object.defineProperty(e,"__esModule",{value:!0});var s=n(151),o=n.n(s),r=n(3),a=n.n(r),c=n(149),u=n.n(c),l=n(884),f=n.n(l),d=n(892),h=n.n(d),m=n(56),p=n(9),v=n(87);e.default={components:{CommentForm:f.a,CommentList:h.a},props:["sectionInfo"],data:function(){return{canFetch:!0,commentList:[],query:{entryId:"",startTime:"",pageSize:20}}},watch:{$route:function(){this.fetch()},sectionInfo:function(){var t=this;this.$nextTick(function(){"#comment"===t.$route.hash&&(t.$refs.commentForm.focus(),Object(m.h)(t.$refs.commentForm))})}},computed:u()({sortArr:function(){return this.commentList.map(function(t){return t.createdAt})[0]},section:function(){return a()(this.sectionInfo,{user:this.user})}},Object(v.mapGetters)({user:p.USER})),methods:{getCommentList:function(){var t=this,e=this.$route.params.sectionId,n=a()(this.query,{entryId:e});this.canFetch&&(this.canFetch=!1,this.$getBean("xiaoceCommentBusiness").getCommentList(n).then(function(e){t.commentList=[].concat(o()(t.commentList),o()(e.list)),t.$nextTick(function(){t.canFetch=!0,t.query.startTime=i(t.commentList)})}).catch(function(){t.canFetch=!0}))},onSubmitedComment:function(){this.commentList=[],this.query.startTime=null,this.getCommentList()},onShouldFetchMoreComment:function(){this.getCommentList()},setXiaoceSectionView:function(){var t=this.$route.params.id,e=this.$route.params.sectionId;e&&this.$getBean("xiaoceBusiness").setXiaoceSectionView({id:t,sectionId:e}).then(function(t){}).catch(function(){})},fetch:function(){this.setXiaoceSectionView(),this.getCommentList()}},mounted:function(){this.fetch(),this.removeCopyListener=Object(m.c)(document,"copy",function(t){var e=window.getSelection().toString().trim();if(e.length>=120){t.preventDefault();var n=e.substring(0,1024)+"...\n";n=[n,"https://juejin.im","掘金 — 一个帮助开发者成长的社区"].join("\n"),t.clipboardData.setData("text/plain",n),t.clipboardData.setData("text/html",n)}})},beforeDestroy:function(){}}},1334:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"section-content"},[n("div",{staticClass:"section-page book-section-view"},[n("div",{staticClass:"entry-content",domProps:{innerHTML:t._s(t.sectionInfo.html)}}),n("section",{staticClass:"book-comments"},[n("div",{staticClass:"box-title"},[t._v("留言")]),n("div",{staticClass:"comment-box"},[n("comment-form",{ref:"commentForm",staticClass:"comment-form",attrs:{id:"comment",user:t.user,entry:t.section,type:"book",placeholder:"写下你的留言"},on:{submited:t.onSubmitedComment}})],1),n("comment-list",{staticClass:"comment-list",attrs:{list:t.commentList,entry:t.section,type:"book"},on:{"should-fetch-more":t.onShouldFetchMoreComment}})],1)])])},staticRenderFns:[]}},1335:function(t,e,n){function i(t){n(1336)}var s=n(25)(n(1337),n(1338),i,"data-v-56cf163b",null);t.exports=s.exports},1336:function(t,e){},1337:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["free","curIndex","list"],data:function(){return{}},computed:{notLastPage:function(){return this.curIndex<this.list.length-1},notFirstPage:function(){return this.curIndex>0},bookId:function(){return this.$route.params.id}},methods:{buyBook:function(){this.$emit("buy")},prevPage:function(){this.$emit("prev")},nextPage:function(){this.$emit("next")},setFreeSection:function(t,e){this.$emit("setFreeSection",t,e)},routeSectionId:function(t){var e=t.isFree,n=t.sectionId;(this.free||e)&&this.$emit("linkSection",n)}},mounted:function(){this.removeEventListener=function(){}},beforeDestroy:function(){this.removeEventListener()}}},1338:function(t,e,n){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.list.length>0?i("div",{staticClass:"book-handle"},[t.notFirstPage?i("div",{staticClass:"step-btn step-btn--prev",on:{click:t.prevPage}},[i("img",{attrs:{src:n(1339)}})]):t._e(),t.notLastPage?i("div",{staticClass:"step-btn step-btn--next",on:{click:t.nextPage}},[i("img",{attrs:{src:n(1340)}})]):t._e(),!t.notLastPage&&t.free?i("router-link",{staticClass:"step-btn step-btn--finished",attrs:{to:t.$booksIndex()}},[i("img",{attrs:{src:n(1341)}})]):t._e(),t.notLastPage||t.free?t._e():i("div",{staticClass:"step-btn step-btn--buy",on:{click:t.buyBook}},[t._v("购买")])],1):t._e()},staticRenderFns:[]}},1339:function(t,e,n){t.exports=n.p+"static/img/prev.87ad47e.svg"},1340:function(t,e,n){t.exports=n.p+"static/img/next.54d8a35.svg"},1341:function(t,e,n){t.exports=n.p+"static/img/finished.86e7f07.svg"},1342:function(t,e,n){function i(t){n(1343)}var s=n(25)(n(1344),n(1345),i,"data-v-2aea5ce6",null);t.exports=s.exports},1343:function(t,e){},1344:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["curIndex","list"]}},1345:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"book-progress"},[n("ul",t._l(t.list,function(e,i){return n("li",{class:{active:i<=t.curIndex}})}))])},staticRenderFns:[]}},1346:function(t,e,n){function i(t){n(1347),n(1348)}var s=n(25)(n(1349),n(1354),i,"data-v-8da8f204",null);t.exports=s.exports},1347:function(t,e){},1348:function(t,e){},1349:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1350),s=n.n(i);e.default={components:{SectionHandle:s.a},props:["curIndex","free","admin","info","list"],data:function(){return{defaultText:"小册章节标题"}},computed:{tryRead:function(){var t=this.info,e=t.price,n=t.isBuy;return!(0===e)&&this.admin||!n},bookId:function(){return this.$route.params.id}},methods:{setFreeSection:function(t,e){this.$emit("setFreeSection",t,e)},routeSectionId:function(t){var e=t.isFree,n=t.sectionId,i=t.isFinished,s=n!==this.$route.params.sectionId;i=void 0!==i&&i;var o=(this.info.isFinished||i||this.admin)&&(this.free||e);s&&o&&this.$emit("linkSection",n)}},mounted:function(){}}},1350:function(t,e,n){function i(t){n(1351)}var s=n(25)(n(1352),n(1353),i,"data-v-39e86d04",null);t.exports=s.exports},1351:function(t,e){},1352:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(23),s=n.n(i);e.default={props:["info","item"],data:function(){return{actionItem:{more:{active:!1}}}},computed:{bookId:function(){return this.$route.params.id}},methods:{toggleActivateActionItem:function(t){var e=this;s()(this.actionItem).forEach(function(n){e.actionItem[n].active=t===n&&!e.actionItem[n].active})},routeEdit:function(t){var e="/editor/book/"+this.bookId+"/section/"+t;window.open(e,"_blank")},setFreeSection:function(t,e){this.$emit("setFreeSection",t,e)}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.ROOT_CONTAINER_CLICK,function(){s()(t.actionItem).forEach(function(e){t.actionItem[e].active=!1})})}}},1353:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.info.isEditor?n("div",{staticClass:"more",class:{open:t.actionItem.more.active},on:{mouseleave:function(e){t.actionItem.more.active=!1},click:function(e){e.stopPropagation(),e.preventDefault(),t.toggleActivateActionItem("more")}}},[n("div",{staticClass:"more-menu"},[t.item.isFree?t._e():n("div",{on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.setFreeSection(t.item.sectionId,!0)}}},[t._v("设置为试读")]),t.item.isFree?n("div",{on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.setFreeSection(t.item.sectionId,!1)}}},[t._v("取消试读")]):t._e(),n("div",{on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.routeEdit(t.item.sectionId)}}},[t._v("编辑")])])]):t._e()},staticRenderFns:[]}},1354:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"section-menu"},t._l(t.list,function(e,i){return n("a",{key:i,staticClass:"section",class:{"route-active":i===t.curIndex,"section-link":t.free||e.isFree,read:e.read},on:{click:function(n){t.routeSectionId(e)}}},[n("div",{staticClass:"step"},[n("div",{staticClass:"step-btn"},[t._v(t._s(i+1))])]),n("div",{staticClass:"center"},[n("div",{staticClass:"title"},[t._v(t._s(e.title||t.defaultText))]),n("div",{staticClass:"sub-line"},[e.isFree&&t.tryRead?n("div",{staticClass:"to-read"},[t._v("试读")]):t._e()])]),n("section-handle",{attrs:{info:t.info,item:e},on:{setFreeSection:t.setFreeSection}})],1)}))},staticRenderFns:[]}},1355:function(t,e,n){function i(t){n(1356)}var s=n(25)(n(1357),n(1358),i,"data-v-11fc2358",null);t.exports=s.exports},1356:function(t,e){},1357:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(149),s=n.n(i),o=n(210),r=n(87),a=n(9),c=n(207),u=n.n(c);e.default={components:{Avatar:u.a},data:function(){return{bdPageUrlForNav:o.e,isShowUserDropdownList:!1}},computed:s()({},Object(r.mapGetters)({user:a.USER,hasWallet:a.HAS_WALLET})),methods:{hideActionList:function(){this.isShowUserDropdownList=!1},onUserActionClick:function(){this.isShowUserDropdownList=!this.isShowUserDropdownList},openEditorPage:function(){var t=this.$getBean("editorBusiness");window.location.href=t.getPostEditUrl()},openXiaoceEditorPage:function(){var t=this.$getBean("editorBusiness");window.location.href=t.getXiaoceEditUrl()},openDraftIndexPage:function(){var t=this.$getBean("editorBusiness");window.location.href=t.getDraftIndexUrl()},login:function(){this.$requestLogin()},register:function(){this.$requestRegister()},logout:function(){window.confirm("确定登出吗？每一片贫瘠的土地都需要坚定的挖掘者！")&&this.$requestLogout()}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.ROOT_CONTAINER_CLICK,function(){t.hideActionList()})}}},1358:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"user-auth"},[t.user?n("div",{staticClass:"nav-item menu",on:{click:function(e){e.stopPropagation(),t.onUserActionClick(e)}}},[n("avatar",{staticClass:"avatar",attrs:{user:t.user}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowUserDropdownList,expression:"isShowUserDropdownList"}],staticClass:"nav-menu user-dropdown-list"},[n("ul",{staticClass:"nav-menu-item-group"},[n("li",{staticClass:"nav-menu-item",on:{click:t.openEditorPage}},[t._m(0)]),t.user.isXiaoceAuthor?n("li",{staticClass:"nav-menu-item",on:{click:t.openXiaoceEditorPage}},[t._m(1)]):t._e(),n("li",{staticClass:"nav-menu-item",on:{click:t.openDraftIndexPage}},[t._m(2)])]),n("ul",{staticClass:"nav-menu-item-group"},[n("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:t.$userRoute(t.user)}},[n("a",[n("i",{staticClass:"fengwei fw-person"}),n("span",[t._v("我的主页")])])]),n("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:t.$userRoute(t.user,"like")}},[n("a",[n("i",{staticClass:"fengwei fw-like"}),n("span",[t._v("我喜欢的")])])]),t.user.isXiaoceAuthor?n("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:t.$userRoute(t.user,"book")}},[n("a",[n("i",{staticClass:"fengwei fw-xiaoce"}),n("span",[t._v("我的小册")])])]):t._e(),n("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:t.$userRoute(t.user,"collection")}},[n("a",[n("i",{staticClass:"fengwei fw-collection"}),n("span",[t._v("我的收藏集")])])]),n("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:t.$userRoute(t.user,"bought")}},[n("a",[n("i",{staticClass:"fengwei fw-bought"}),n("span",[t._v("已购")])])]),t.hasWallet?n("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:"/user/wallet"}},[n("a",[n("i",{staticClass:"fengwei fw-wallet"}),n("span",[t._v("我的钱包")])])]):t._e(),n("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:"/subscribe"}},[n("a",[n("i",{staticClass:"fengwei fw-tag"}),n("span",[t._v("标签管理")])])])],1),n("ul",{staticClass:"nav-menu-item-group"},[t.user?n("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:"/user/settings"}},[n("a",[n("i",{staticClass:"fengwei fw-setting"}),n("span",[t._v("设置")])])]):t._e(),n("li",{staticClass:"nav-menu-item more"},[t._m(3),n("div",{staticClass:"nav-menu more-dropdown-list"},[n("ul",{staticClass:"nav-menu-item-group"},[n("li",{staticClass:"nav-menu-item"},[n("a",{directives:[{name:"link",rawName:"v-link.blank",value:"/app",expression:"'/app'",modifiers:{blank:!0}}]},[t._v("下载应用")])]),n("li",{staticClass:"nav-menu-item"},[n("a",{directives:[{name:"link",rawName:"v-link.blank",value:"/about",expression:"'/about'",modifiers:{blank:!0}}]},[t._v("关于")])]),n("li",{staticClass:"nav-menu-item"},[n("a",{directives:[{name:"link",rawName:"v-link.blank",value:"https://xitu.io/jobs",expression:"'https://xitu.io/jobs'",modifiers:{blank:!0}}]},[t._v("加入我们")])]),n("li",{staticClass:"nav-menu-item"},[n("a",{directives:[{name:"link",rawName:"v-link.external.blank",value:"https://github.com/xitu/gold-miner",expression:"'https://github.com/xitu/gold-miner'",modifiers:{external:!0,blank:!0}}]},[t._v("翻译计划")])]),n("li",{staticClass:"nav-menu-item"},[n("a",{directives:[{name:"link",rawName:"v-link.blank",value:t.bdPageUrlForNav,expression:"bdPageUrlForNav",modifiers:{blank:!0}}]},[t._v("合作伙伴")])])])])])],1),t.user?n("ul",{staticClass:"nav-menu-item-group"},[n("li",{staticClass:"nav-menu-item",on:{click:t.logout}},[t._m(4)])]):t._e()])],1):t._e(),t.user?t._e():n("div",{staticClass:"nav-item auth"},[n("span",{staticClass:"login",on:{click:t.login}},[t._v("登录")]),n("span",{staticClass:"register",on:{click:t.register}},[t._v("注册")])])])},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a",[n("i",{staticClass:"fengwei fw-write"}),n("span",[t._v("写文章")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a",[n("i",{staticClass:"fengwei fw-xiaocepost"}),n("span",[t._v("写小册")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a",[n("i",{staticClass:"fengwei fw-draft"}),n("span",[t._v("草稿")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a",[n("i",{staticClass:"fengwei fw-info"}),n("span",[t._v("关于")]),n("i",{staticClass:"ion-chevron-right more-icon"})])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a",[n("i",{staticClass:"fengwei fw-logout"}),n("span",[t._v("登出")])])}]}},1359:function(t,e,n){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.bookInfo?i("div",{staticClass:"book-read-view"},[i("section",{staticClass:"book-section",class:{"fold-pc":t.foldPc}},[i("div",{staticClass:"book-summary",class:{"unfold-mobile":t.unfoldM}},[i("div",{staticClass:"book-summary-masker",on:{click:t.toggleSummary}}),i("div",{staticClass:"book-summary-inner"},[i("div",{staticClass:"book-summary__header"},[i("app-link",{staticClass:"logo",attrs:{to:t.$booksIndex()}},[i("img",{attrs:{src:n(1360)}})]),i("div",{staticClass:"label"},[t._v("小册")]),1==t.bookInfo.isPublish?i("div",{staticClass:"audit"},[t._v("审核中")]):t._e()],1),t.free?t._e():i("div",{staticClass:"section-buy",on:{click:t.verifyBuyBook}},[t._v("立即购买")]),i("book-directory",{staticClass:"book-directory",class:{bought:!t.canPayment},attrs:{free:t.free,admin:t.isAdmin,info:t.bookInfo,list:t.sectionList,"cur-index":t.curDirectoryIndex},on:{setFreeSection:t.setFreeSection,linkSection:t.linkSection}})],1)]),i("div",{staticClass:"book-content"},[i("div",{staticClass:"book-content-inner"},[i("div",{staticClass:"book-content__header",class:{visible:t.isHeaderVisible}},[i("div",{staticClass:"switch",on:{click:t.toggleSummary}},[i("img",{attrs:{src:n(1361)}})]),i("div",{staticClass:"menu",on:{click:t.toggleSummary}},[i("img",{attrs:{src:n(1362)}})]),i("div",{staticClass:"title"},[i("app-link",{attrs:{to:t.$bookInfo(t.bookId)}},[t._v(t._s(t.bookInfo.title))])],1),i("user-auth",{staticClass:"user-auth"}),t.foldPc?i("book-progress",{staticClass:"book-progress",attrs:{"cur-index":t.curDirectoryIndex,list:t.sectionIdList}}):t._e()],1),i("div",{ref:"bookBody",staticClass:"book-body",class:t.directionClass},[i("transition",{attrs:{name:"fade"}},[t.sectionInfo?i("section-"+t.view,{tag:"component",staticClass:"book-section-content",attrs:{"section-info":t.sectionInfo}}):t._e()],1)],1),t.sectionInfo?i("book-direction",{staticClass:"book-direction",attrs:{free:t.free,"cur-index":t.curFreeDirectoryIndex,list:t.filterList},on:{buy:t.buyBookForDirection,prev:t.prevPage,next:t.nextPage}}):t._e(),t.free?t._e():i("div",{staticClass:"bottom-mobile-buy",on:{click:t.verifyBuyBook}},[t._v("购买 ￥"+t._s(t.bookInfo.price))])],1)])]),i("wechat-quick-login"),i("book-payment-popup")],1):t._e()},staticRenderFns:[]}},1360:function(t,e,n){t.exports=n.p+"static/img/logo.a7995ad.svg"},1361:function(t,e,n){t.exports=n.p+"static/img/icon.3e69d5a.svg"},1362:function(t,e,n){t.exports=n.p+"static/img/menu.74b9add.svg"},788:function(t,e,n){function i(t){n(1327)}var s=n(25)(n(1328),n(1359),i,"data-v-a39a1c6e",null);t.exports=s.exports},822:function(t,e,n){"use strict";function i(){return new l}e.a=i;var s=n(5),o=n.n(s),r=n(0),a=n.n(r),c=n(1),u=n.n(c),l=function(){function t(){a()(this,t),this.busy=!1}return u()(t,[{key:"do",value:function(t){var e=this;return this.busy?o.a.resolve():(this.busy=!0,o.a.resolve("function"==typeof t?t():t).then(function(t){return e.busy=!1,t}).catch(function(t){return e.busy=!1,o.a.reject(t)}))}}]),t}()},824:function(t,e,n){function i(t){n(829)}var s=n(25)(n(830),n(831),i,"data-v-311d2efa",null);t.exports=s.exports},825:function(t,e,n){"use strict";function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000000",n=new o.a({content:t,color:e,padding:0,width:410,height:410,background:"#ffffff",ecl:"L"}).svg();return"data:image/svg+xml;utf8,"+encodeURIComponent(n)}e.a=i;var s=n(211),o=n.n(s)},829:function(t,e){},830:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(9),s=n(822),o=n(207),r=n.n(o);e.default={components:{Avatar:r.a},props:["userId"],data:function(){return{user:null,followLock:Object(s.a)(),visible:!1,top:0,left:0}},computed:{popoverStyle:function(){return{top:this.top+"px",left:this.left+"px"}},position:function(){return this.user&&(this.$userPosition(this.user)||this.user.self_description||"暂无简介")},self:function(){return this.user&&this.user.self},followed:function(){return this.user&&this.user.followed}},methods:{fetch:function(){var t=this;return this.$getBean("userBusiness").getUserById(this.userId).then(function(e){t.user=e})},toggleFollow:function(){var t=this;this.followLock.do(function(){return t.$ensureAuthorized().then(function(){return t.$store.dispatch(i.TOGGLE_FOLLOW_USER,t.user).catch(function(e){t.$error(e)})}).catch(function(){})})},showPopover:function(t){var e=this;clearTimeout(this.hideToken),this.showToken=setTimeout(function(){e.fetch().then(function(){e.showToken&&(e.visible=!0,e.$nextTick(function(){var n=t.target.getBoundingClientRect(),i=e.$refs.popover,s=i.offsetWidth,o=i.offsetHeight,r=n.left-s/2+20,a=n.top-o-10;a<60&&(r=n.left-10-s,a=n.top-o/2+10),r=Math.max(0,r),e.left=r,e.top=a}))})},300)},hidePopover:function(){var t=this;clearTimeout(this.showToken),this.showToken=null,this.hideToken=setTimeout(function(){t.popoverTimeout=null,t.visible=!1},300)}}}},831:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"user-popover-box",attrs:{"st:block":"userPopover","st:state":t.userId},on:{mouseenter:function(e){t.showPopover(e)},mouseleave:t.hidePopover}},[t.visible?n("div",{ref:"popover",staticClass:"user-popover",style:t.popoverStyle},[n("div",{staticClass:"info-row"},[n("app-link",{attrs:{to:t.$userRoute(t.user),blank:!0}},[n("avatar",{staticClass:"avatar",attrs:{user:t.user}})],1),n("div",{staticClass:"user-info"},[n("app-link",{staticClass:"username",attrs:{to:t.$userRoute(t.user),blank:!0}},[t._v(t._s(t.user.username))]),n("div",{staticClass:"position"},[t._v(t._s(t.position))])],1)],1),n("div",{staticClass:"meta-row"},[n("ul",{staticClass:"meta-list"},[n("li",{staticClass:"item"},[n("div",{staticClass:"count"},[t._v(t._s(t.user.postedEntriesCount||0))]),n("div",{staticClass:"title"},[t._v("分享")])]),n("li",{staticClass:"item"},[n("div",{staticClass:"count"},[t._v(t._s(t.user.followersCount||0))]),n("div",{staticClass:"title"},[t._v("关注者")])]),n("li",{staticClass:"item"},[n("div",{staticClass:"count"},[t._v(t._s(t.user.totalCollectionsCount||0))]),n("div",{staticClass:"title"},[t._v("获得喜欢")])])]),t.self?t._e():n("button",{staticClass:"follow-btn",class:{followed:t.followed},attrs:{"st:name":"followBtn"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.toggleFollow(e)}}},[t._v(t._s(t.followed?"已关注":"关注"))])])]):t._e(),t._t("default")],2)},staticRenderFns:[]}},839:function(t,e,n){var i,s,o;/*!
	Autosize 3.0.20
	license: MIT
	http://www.jacklmoore.com/autosize
*/
!function(n,r){s=[e,t],i=r,void 0!==(o="function"==typeof i?i.apply(e,s):i)&&(t.exports=o)}(0,function(t,e){"use strict";function n(t){function e(e){var n=t.style.width;t.style.width="0px",t.offsetWidth,t.style.width=n,t.style.overflowY=e}function n(t){for(var e=[];t&&t.parentNode&&t.parentNode instanceof Element;)t.parentNode.scrollTop&&e.push({node:t.parentNode,scrollTop:t.parentNode.scrollTop}),t=t.parentNode;return e}function i(){var e=t.style.height,i=n(t),s=document.documentElement&&document.documentElement.scrollTop;t.style.height="auto";var o=t.scrollHeight+a;if(0===t.scrollHeight)return void(t.style.height=e);t.style.height=o+"px",c=t.clientWidth,i.forEach(function(t){t.node.scrollTop=t.scrollTop}),s&&(document.documentElement.scrollTop=s)}function s(){i();var n=Math.round(parseFloat(t.style.height)),s=window.getComputedStyle(t,null),o=Math.round(parseFloat(s.height));if(o!==n?"visible"!==s.overflowY&&(e("visible"),i(),o=Math.round(parseFloat(window.getComputedStyle(t,null).height))):"hidden"!==s.overflowY&&(e("hidden"),i(),o=Math.round(parseFloat(window.getComputedStyle(t,null).height))),u!==o){u=o;var a=r("autosize:resized");try{t.dispatchEvent(a)}catch(t){}}}if(t&&t.nodeName&&"TEXTAREA"===t.nodeName&&!o.has(t)){var a=null,c=t.clientWidth,u=null,l=function(){t.clientWidth!==c&&s()},f=function(e){window.removeEventListener("resize",l,!1),t.removeEventListener("input",s,!1),t.removeEventListener("keyup",s,!1),t.removeEventListener("autosize:destroy",f,!1),t.removeEventListener("autosize:update",s,!1),Object.keys(e).forEach(function(n){t.style[n]=e[n]}),o.delete(t)}.bind(t,{height:t.style.height,resize:t.style.resize,overflowY:t.style.overflowY,overflowX:t.style.overflowX,wordWrap:t.style.wordWrap});t.addEventListener("autosize:destroy",f,!1),"onpropertychange"in t&&"oninput"in t&&t.addEventListener("keyup",s,!1),window.addEventListener("resize",l,!1),t.addEventListener("input",s,!1),t.addEventListener("autosize:update",s,!1),t.style.overflowX="hidden",t.style.wordWrap="break-word",o.set(t,{destroy:f,update:s}),function(){var e=window.getComputedStyle(t,null);"vertical"===e.resize?t.style.resize="none":"both"===e.resize&&(t.style.resize="horizontal"),a="content-box"===e.boxSizing?-(parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)):parseFloat(e.borderTopWidth)+parseFloat(e.borderBottomWidth),isNaN(a)&&(a=0),s()}()}}function i(t){var e=o.get(t);e&&e.destroy()}function s(t){var e=o.get(t);e&&e.update()}var o="function"==typeof Map?new Map:function(){var t=[],e=[];return{has:function(e){return t.indexOf(e)>-1},get:function(n){return e[t.indexOf(n)]},set:function(n,i){-1===t.indexOf(n)&&(t.push(n),e.push(i))},delete:function(n){var i=t.indexOf(n);i>-1&&(t.splice(i,1),e.splice(i,1))}}}(),r=function(t){return new Event(t,{bubbles:!0})};try{new Event("test")}catch(t){r=function(t){var e=document.createEvent("Event");return e.initEvent(t,!0,!1),e}}var a=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?(a=function(t){return t},a.destroy=function(t){return t},a.update=function(t){return t}):(a=function(t,e){return t&&Array.prototype.forEach.call(t.length?t:[t],function(t){return n(t)}),t},a.destroy=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],i),t},a.update=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],s),t}),e.exports=a})},880:function(t,e,n){function i(t){n(898)}var s=n(25)(n(899),n(908),i,"data-v-746db1b2",null);t.exports=s.exports},884:function(t,e,n){function i(t){n(885)}var s=n(25)(n(886),n(891),i,"data-v-efcd2e56",null);t.exports=s.exports},885:function(t,e){},886:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(5),s=n.n(i),o=n(9),r=n(839),a=n.n(r),c=n(207),u=n.n(c),l=n(887),f=n.n(l);e.default={components:{Avatar:u.a,ImageUploader:f.a},props:["user","entry","vote","placeholder","type"],data:function(){return{content:"",isActionBoxVisible:!1,submitting:!1,metaKey:!1,ctrlKey:!1,enterKey:!1}},computed:{submitAction:function(){switch(this.type){case"book":return o.SUBMIT_BOOK_COMMENT;case"repo":return o.SUBMIT_REPO_COMMENT;default:return o.SUBMIT_COMMENT}}},watch:{content:function(t){t&&!this.user&&this.$requestRegister()}},methods:{focus:function(){this.$refs.input.focus()},blur:function(){this.content||(this.isActionBoxVisible=!1)},submit:function(){var t=this,e=this.entry,n=this.content.trim();return this.user?n?(this.submitting=!0,void this.uploadImage().then(function(i){return t.$store.dispatch(t.submitAction,{entry:e,content:n,imageUrl:i})}).then(function(){t.$barrage(t.content),t.$refs.imageUploader.cleanFile(),t.content="",t.submitting=!1,t.$nextTick(function(){a.a.update(t.$refs.input)}),t.$emit("submited")}).catch(function(e){t.submitting=!1,t.$error(e)})):void this.$alert("评论不能为空"):void this.$requestRegister()},uploadImage:function(){return this.$refs.imageUploader.file?this.$refs.imageUploader.upload():s.a.resolve()},listenerKeykown:function(t){var e={17:"ctrlKey",91:"metaKey",93:"metaKey",224:"metaKey",13:"enterKey"},n=e[t.keyCode];n&&(this[n]=!0)},listenerKeyup:function(t){this.ctrlKey=!1,this.metaKey=!1,this.enterKey=!1},quickSubmit:function(t){(this.metaKey||this.ctrlKey)&&this.enterKey&&this.submit()}},mounted:function(){a()(this.$refs.input)}}},887:function(t,e,n){function i(t){n(888)}var s=n(25)(n(889),n(890),i,"data-v-54e3f196",null);t.exports=s.exports},888:function(t,e){},889:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(212),s=["jpg","png"];e.default={data:function(){return{file:null,url:null}},methods:{showFileDialog:function(){this.$refs.input.click()},changeFile:function(t){this.file=t,window.URL.revokeObjectURL(this.url),this.url=t?window.URL.createObjectURL(t):null},cleanFile:function(){this.changeFile(null)},onActionBoxClick:function(){this.url?this.cleanFile():this.showFileDialog()},onFileSelected:function(t){var e=this;if(this.$refs.input.value=null,t)return this.isWithVaildSize(t)?void Object(i.a)(t,s).then(function(n){n?e.changeFile(t):e.$alert("不支持此格式的图片上传")}):void this.$alert("文件过大")},isWithVaildSize:function(t){return t.size<=1048576},upload:function(){return this.$getBean("uploadBusiness").uploadFile(this.file)}}}},890:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"image-uploader"},[n("input",{ref:"input",staticClass:"input",attrs:{type:"file"},on:{change:function(e){t.onFileSelected(e.target.files[0])}}}),t.url?n("div",{staticClass:"preview-box"},[n("img",{staticClass:"preview",attrs:{src:t.url}}),n("button",{staticClass:"clean-btn",attrs:{title:"移除图片"},on:{click:t.cleanFile}},[n("i",{staticClass:"ion-close-circled"})])]):n("button",{staticClass:"upload-btn",on:{click:t.showFileDialog}},[n("i",{staticClass:"icon ion-image"}),n("span",[t._v("上传图片")])])])},staticRenderFns:[]}},891:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment-form",on:{click:function(t){t.stopPropagation()},keyup:function(e){e.stopPropagation(),t.listenerKeyup(e)},keydown:t.listenerKeykown}},[n("avatar",{staticClass:"avatar",attrs:{user:t.user}}),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],ref:"input",staticClass:"content-input",attrs:{placeholder:t.placeholder||"说说你的看法"},domProps:{value:t.content},on:{focus:function(e){t.isActionBoxVisible=!0},keyup:t.quickSubmit,input:function(e){e.target.composing||(t.content=e.target.value)}}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isActionBoxVisible||t.vote,expression:"isActionBoxVisible || vote"}],staticClass:"action-box"},[n("image-uploader",{directives:[{name:"show",rawName:"v-show",value:t.vote,expression:"vote"}],ref:"imageUploader",staticClass:"image-uploader"}),n("div",{staticClass:"submit-box"},[n("span",{staticClass:"submit-text"},[t._v("Ctrl or ⌘ + Enter")]),n("button",{staticClass:"submit-btn",on:{click:t.submit}},[t._v("评论")])])],1),t.submitting?n("div",{staticClass:"submitting-mask"},[t._v("提交中...")]):t._e()],1)},staticRenderFns:[]}},892:function(t,e,n){function i(t){n(893)}var s=n(25)(n(894),n(911),i,"data-v-51163f89",null);t.exports=s.exports},893:function(t,e){},894:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(56),s=n(895),o=n.n(s);e.default={components:{Comment:o.a},props:["list","entry","type"],methods:{fetchMoreIfConditionIsSatisfied:function(){Object(i.a)(this.$refs.list)>-200&&this.$emit("should-fetch-more")}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.ROOT_CONTAINER_SCROLL,function(){t.fetchMoreIfConditionIsSatisfied()}),Object(i.d)(this.$refs.list,function(){t.fetchMoreIfConditionIsSatisfied()})}}},895:function(t,e,n){function i(t){n(896)}var s=n(25)(n(897),n(910),i,"data-v-7f6a837b",null);t.exports=s.exports},896:function(t,e){},897:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(9),s=n(16),o=n(150),r=n(822),a=n(207),c=n.n(a),u=n(824),l=n.n(u),f=n(880),d=n.n(f);e.default={components:{Avatar:c.a,UserPopover:l.a,SubCommentBox:d.a},props:["comment","entry","type"],data:function(){return{isShowAll:!1,isSubCommentBoxActive:!1,likeLock:Object(r.a)()}},computed:{date:function(){return Object(s.c)(this.comment.createdAt)},displayedLikeCount:function(){return Object(o.a)(this.comment.likesCount)},replyPlaceholder:function(){return"对 "+this.comment.user.username+" 的回复"},toggleSubCommentBtnTitle:function(){var t=this.comment.subCount;return this.isSubCommentBoxActive?"收起评论":t?this.comment.subCount+"条评论":"评论"},limitedContent:function(){return this.$getBean("commentBusiness").limitCommentContent(this.comment.content)},collapsed:function(){return this.limitedContent.length<this.comment.content.length&&!this.isShowAll},toggleLikeAction:function(){switch(this.type){case"book":return i.TOGGLE_LIKE_BOOK_COMMENT;case"repo":return i.TOGGLE_LIKE_REPO_COMMENT;default:return i.TOGGLE_LIKE_COMMENT}}},methods:{toggleLike:function(){var t=this;this.likeLock.do(function(){return t.$ensureAuthorized().then(function(){return t.$store.dispatch(t.toggleLikeAction,{comment:t.comment,entry:t.entry}).catch(function(e){t.$error(e)})}).catch(function(){})})}},mounted:function(){this.comment.createdAt=this.comment.createdAt}}},898:function(t,e){},899:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n.n(i),o=n(5),r=n.n(o),a=n(9),c=n(822),u=n(56),l=n(37),f=n(900),d=n.n(f),h=n(904),m=n.n(h),p=n(839),v=n.n(p),g=(n(32),function(){return{page:1,total:0,list:[],fetchLock:Object(c.a)(),replyLock:Object(c.a)(),replyForm:{content:"",comment:null},metaKey:!1,ctrlKey:!1,enterKey:!1}});e.default={components:{SubComment:d.a,Pagination:m.a},props:["parent","entry","type"],data:g,computed:{isMobile:function(){return Object(l.d)()},pageSize:function(){return this.isMobile?20:5},replyPlaceholder:function(){var t=((this.replyForm.comment||{}).user||{}).username;return t?"回复 "+t+" ：":"输入评论"},shouldCancelReply:function(){return this.replyForm.comment&&!this.replyForm.content},canReply:function(){return!!this.replyForm.content.trim()},replyBtnTitle:function(){return this.shouldCancelReply?"取消":"评论"},totalPage:function(){return Math.max(Math.ceil(this.total/5),1)},startTime:function(){return this.list.length?this.list[this.list.length-1].createdAt:null},fetching:function(){return this.fetchLock.busy},empty:function(){return!this.list.length&&!this.fetching},commentBusiness:function(){switch(this.type){case"book":return this.$getBean("xiaoceCommentBusiness");case"repo":return this.$getBean("repoCommentBusiness");default:return this.$getBean("commentBusiness")}},replyAction:function(){switch(this.type){case"book":return a.REPLY_BOOK_COMMENT;case"repo":return a.REPLY_REPO_COMMENT;default:return a.REPLY_COMMENT}}},methods:{close:function(){this.$emit("close")},getTarUser:function(t){return t.replyCommentId!==this.parent.id?t.replyUser:null},prepareReply:function(t){this.$refs.replyInput.focus(),this.replyForm.content="",this.replyForm.comment=t},cancelReply:function(){this.replyForm.content="",this.replyForm.comment=null},listenerKeyup:function(t){this.ctrlKey=!1,this.metaKey=!1,this.enterKey=!1},listenerKeykown:function(t){var e={17:"ctrlKey",91:"metaKey",93:"metaKey",224:"metaKey",13:"enterKey"},n=e[t.keyCode];n&&(this[n]=!0)},reply:function(){var t=this,e={entry:this.entry,parent:this.parent,tar:this.replyForm.comment||this.parent,content:this.replyForm.content.trim()};this.replyLock.do(function(){return t.$ensureAuthorized().then(function(){return t.$store.dispatch(t.replyAction,e).then(function(){t.$barrage(t.replyForm.content),t.refresh(),t.$nextTick(function(){v.a.update(t.$refs.replyInput)})}).catch(function(e){t.$error(e)})}).catch(function(){})})},onReplyBtnClick:function(){this.shouldCancelReply?this.cancelReply():this.canReply&&this.reply()},quickSubmit:function(){(this.metaKey||this.ctrlKey)&&this.enterKey&&this.reply()},refresh:function(){this.reset(),this.fetch()},fetch:function(){var t=this,e={commentId:this.parent.id,entryId:this.entry.id,page:this.page,pageSize:this.pageSize};return this.fetchLock.do(function(){return t.commentBusiness.getSubCommentList(e).then(function(e){t.list=e.list,t.total=e.total})}).catch(function(e){t.$error(e)})},gotoPage:function(t){var e=this;this.page=t,this.fetch().then(function(){Object(u.i)(e.$refs.subCommentBox,-110)})},fetchMore:function(){var t=this;this.fetchLock.do(function(){return t.commentBusiness.getSubCommentList({commentId:t.parent.id,entryId:t.entry.id,page:t.page+1,pageSize:t.pageSize}).then(function(e){t.page=t.page+1,t.list=t.list.concat(e.list),t.total=e.total}).then(function(){return new r.a(function(t){return window.setTimeout(t,500)})})}).catch(function(e){t.$error(e)})},reset:function(){s()(this,g())}},mounted:function(){var t=this;if(v()(this.$refs.replyInput),Object(u.f)(this.$refs.subCommentBoxInner,function(e){e<50&&t.fetchMore()}),this.$refs.replyInput.focus(),this.isMobile){var e=this.$getBean("eventBus");e.emit(e.eventType.LOCK_ROOT_CONTAINER_SCROLL)}this.refresh()},beforeDestroy:function(){if(this.isMobile){var t=this.$getBean("eventBus");t.emit(t.eventType.UNLOCK_ROOT_CONTAINER_SCROLL)}}}},900:function(t,e,n){function i(t){n(901)}var s=n(25)(n(902),n(903),i,"data-v-6fdfc18a",null);t.exports=s.exports},901:function(t,e){},902:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(16),s=n(207),o=n.n(s),r=n(824),a=n.n(r);e.default={components:{Avatar:o.a,UserPopover:a.a},props:["comment","tarUser"],data:function(){return{isShowAll:!1}},computed:{date:function(){return Object(i.c)(this.comment.createdAt)},limitedContent:function(){return this.$getBean("commentBusiness").limitCommentContent(this.comment.content)},collapsed:function(){return this.limitedContent.length<this.comment.content.length&&!this.isShowAll}},methods:{reply:function(){this.$emit("reply")}}}},903:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sub-comment"},[n("user-popover",{staticClass:"user-popover--avatar",attrs:{userId:t.comment.user.id}},[n("avatar",{staticClass:"avatar",attrs:{user:t.comment.user}})],1),n("div",{staticClass:"content-box"},[n("div",{staticClass:"header"},[n("div",{staticClass:"user-info"},[n("user-popover",{staticClass:"user-popover--info",attrs:{userId:t.comment.user.id}},[n("app-link",{staticClass:"username",attrs:{to:t.$userRoute(t.comment.user),blank:!0}},[t._v(t._s(t.comment.user.username))])],1),n("div",{staticClass:"position"},[t._v(t._s(t.$userPosition(t.comment.user)))])],1)]),n("div",{staticClass:"content"},[t.tarUser?n("span",{staticClass:"text-reply"},[t._v("回复"),n("app-link",{attrs:{to:t.$userRoute(t.tarUser),blank:!0}},[n("span",{staticClass:"username"},[t._v(t._s(t.tarUser.username))])]),t._v("：")],1):t._e(),t.collapsed?n("span",{staticClass:"content-html collapsed"},[t._v(t._s(t.limitedContent))]):n("span",{directives:[{name:"parse-url",rawName:"v-parse-url",value:t.comment.content,expression:"comment.content"}],staticClass:"content-html"}),t.collapsed?n("span",{staticClass:"show-all",on:{click:function(e){t.isShowAll=!0}}},[t._v("展开全部")]):t._e()]),n("div",{staticClass:"footer"},[n("span",{staticClass:"date"},[t._v(t._s(t.date))]),n("a",{staticClass:"reply-btn",on:{click:t.reply}},[t._v("回复")])])])],1)},staticRenderFns:[]}},904:function(t,e,n){function i(t){n(905)}var s=n(25)(n(906),n(907),i,"data-v-2c38f2aa",null);t.exports=s.exports},905:function(t,e){},906:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(151),s=n.n(i),o=n(88);e.default={props:["current","total"],computed:{canPrev:function(){return this.current>1},canNext:function(){return this.current<this.total},list:function(){var t=this.current,e=this.total;return e<=6?Object(o.a)(1,e):t<=4?[].concat(s()(Object(o.a)(1,4)),[!1,e]):t>=e-4?[1,!1].concat(s()(Object(o.a)(e-4,e))):[1,!1,t,t+1,!1,e]}},methods:{prev:function(){this.update(this.current-1)},next:function(){this.update(this.current+1)},update:function(t){this.$emit("update",t)},onItemClick:function(t){t&&this.update(t)}}}},907:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{staticClass:"pagination"},[t.canPrev?n("li",{staticClass:"item",on:{click:t.prev}},[t._v("上一页")]):t._e(),t._l(t.list,function(e){return n("li",{staticClass:"item",class:{ellipsis:!e,current:e==t.current},on:{click:function(n){t.onItemClick(e)}}},[t._v(t._s(e||"..."))])}),t.canNext?n("li",{staticClass:"item",on:{click:t.next}},[t._v("下一页")]):t._e()],2)},staticRenderFns:[]}},908:function(t,e,n){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"subCommentBox",staticClass:"sub-comment-box",class:{"sub-comment-box__m":t.isMobile}},[n("div",{staticClass:"sub-comment-box__top"},[n("div",{staticClass:"icon-close",on:{click:t.close}}),n("h3",[t._v("评论")])]),n("div",{ref:"subCommentBoxInner",staticClass:"sub-comment-box__inner"},[t.empty?n("div",{staticClass:"empty-comment"},[t._m(0)]):n("div",[n("ul",{staticClass:"sub-comment-list"},t._l(t.list,function(e){return n("li",{key:e.id,staticClass:"item"},[n("sub-comment",{staticClass:"sub-comment",class:{"sub-comment__m":t.isMobile},attrs:{comment:e,tarUser:t.getTarUser(e)},on:{reply:function(n){t.prepareReply(e)}}})],1)})),t.totalPage>1?n("pagination",{staticClass:"pagination",attrs:{total:t.totalPage,current:t.page},on:{update:t.gotoPage}}):t._e()],1),n("form",{staticClass:"reply-form",on:{submit:function(t){t.preventDefault()},keyup:function(e){e.stopPropagation(),t.listenerKeyup(e)},keydown:t.listenerKeykown}},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.replyForm.content,expression:"replyForm.content"}],ref:"replyInput",attrs:{rows:"1",maxlength:"1024",placeholder:t.replyPlaceholder},domProps:{value:t.replyForm.content},on:{keyup:t.quickSubmit,input:function(e){e.target.composing||t.$set(t.replyForm,"content",e.target.value)}}}),n("button",{staticClass:"reply-btn",on:{click:t.onReplyBtnClick}},[t._v(t._s(t.replyBtnTitle))])])])])},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("dl",[i("dt",[i("img",{attrs:{src:n(909)}})]),i("dd",[t._v("暂无评论")])])}]}},909:function(t,e,n){t.exports=n.p+"static/img/empty-comment.40bc8a6.svg"},910:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment"},[n("user-popover",{attrs:{userId:t.comment.user.id}},[n("app-link",{attrs:{to:t.$userRoute(t.comment.user),blank:!0}},[n("avatar",{staticClass:"avatar",attrs:{user:t.comment.user}})],1)],1),n("div",{staticClass:"content-box"},[n("div",{staticClass:"header"},[n("div",{staticClass:"user-info"},[n("user-popover",{attrs:{userId:t.comment.user.id}},[n("app-link",{staticClass:"username",attrs:{to:t.$userRoute(t.comment.user),blank:!0}},[t._v(t._s(t.comment.user.username))])],1),n("div",{staticClass:"position"},[t._v(t._s(t.$userPosition(t.comment.user)))])],1)]),n("div",{staticClass:"content"},[t.comment.reply?n("span",[t._v("回复"),n("router-link",{attrs:{to:t.$userRoute(t.comment.reply.user)}},[n("span",{staticClass:"username"},[t._v(t._s(t.comment.reply.user.username))])]),t._v("：")],1):t._e(),t.collapsed?n("span",{staticClass:"content-html collapsed"},[t._v(t._s(t.limitedContent))]):n("span",{directives:[{name:"parse-url",rawName:"v-parse-url",value:t.comment.content,expression:"comment.content"}],staticClass:"content-html"}),t.collapsed?n("span",{staticClass:"show-all",on:{click:function(e){t.isShowAll=!0}}},[t._v("展开全部")]):t._e()]),n("div",{staticClass:"footer"},[n("button",{staticClass:"like-btn",class:{liked:t.comment.liked},on:{click:t.toggleLike}},[n("i",{staticClass:"collection-arrow-ion ion-arrow-up-b"}),n("span",[t._v(t._s(t.displayedLikeCount))])]),n("span",{staticClass:"sub-comment-btn text-pointer",on:{click:function(e){t.isSubCommentBoxActive=!t.isSubCommentBoxActive}}},[n("span",{staticClass:"title"},[t._v(t._s(t.toggleSubCommentBtnTitle))]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isSubCommentBoxActive,expression:"isSubCommentBoxActive"}],staticClass:"sub-comment--arrow"})]),n("span",{staticClass:"date"},[t._v(t._s(t.date))])]),t.isSubCommentBoxActive?n("sub-comment-box",{staticClass:"sub-comment-box",attrs:{parent:t.comment,entry:t.entry,type:t.type},on:{close:function(e){t.isSubCommentBoxActive=!1}}}):t._e()],1)],1)},staticRenderFns:[]}},911:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{ref:"list",staticClass:"comment-list",attrs:{"st:block":"commentList"}},t._l(t.list,function(e,i){return n("li",{key:i,staticClass:"item"},[n("comment",{attrs:{comment:e,entry:t.entry,type:t.type}})],1)}))},staticRenderFns:[]}},937:function(t,e,n){/**
 * juejin-lazyload v0.1.5
 * (c) 2017 WEBuster <webuster@xitu.io>
 * @license MIT
 */
!function(e,n){t.exports=n()}(0,function(){"use strict";function t(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.addEventListener(e,n,i),function(){t.removeEventListener(e,n,i)}}!function(){function t(t){this.value=t}function e(e){function n(s,o){try{var r=e[s](o),a=r.value;a instanceof t?Promise.resolve(a.value).then(function(t){n("next",t)},function(t){n("throw",t)}):i(r.done?"return":"normal",r.value)}catch(t){i("throw",t)}}function i(t,e){switch(t){case"return":s.resolve({value:e,done:!0});break;case"throw":s.reject(e);break;default:s.resolve({value:e,done:!1})}(s=s.next)?n(s.key,s.arg):o=null}var s,o;this._invoke=function(t,e){return new Promise(function(i,r){var a={key:t,arg:e,resolve:i,reject:r,next:null};o?o=o.next=a:(s=o=a,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},s={threshold:0,interval:200,debounce:!1,reactive:!0,eagerShowing:!1,infoGetter:null,visibleAreaGetter:null,onStateChange:null},o="__JUEJIN_LAZYLOAD";return function(){function r(t,n){e(this,r),this.setOptions(n),this.addOrUpdateElement(t),this.initEventListener()}return n(r,[{key:"setOptions",value:function(t){this.options=i({},s,t)}},{key:"initEventListener",value:function(){var e=this;if(this.options.reactive){var n=this.options.debounce?function(t,e){var n=0;return function(){for(var i=this,s=arguments.length,o=Array(s),r=0;r<s;r++)o[r]=arguments[r];clearTimeout(n),n=setTimeout(function(){return t.apply(i,o)},e)}}(function(){return e.updateState()},this.options.interval):function(t,e){var n=0;return e/=2,function(){for(var i=arguments.length,s=Array(i),o=0;o<i;o++)s[o]=arguments[o];Date.now()-n>=e&&(n=Date.now(),setTimeout(function(){t.apply(null,s)},e))}}(function(){return e.updateState()},this.options.interval);this.removeScrollEventListener=t(window,"scroll",n),this.removeResizeEventListener=t(window,"resize",n)}}},{key:"removeEventListener",value:function(){this.removeScrollEventListener&&this.removeScrollEventListener(),this.removeResizeEventListener&&this.removeResizeEventListener()}},{key:"addOrUpdateElement",value:function(t){var e=this.getElementList(t),n=e.filter(function(t){return!t[o]});this.elementList=(this.elementList||[]).concat(n),e.forEach(this.initElement.bind(this)),this.updateState()}},{key:"removeElement",value:function(t){var e=this.getElementList(t);this.elementList=this.elementList.filter(function(t){return-1===e.indexOf(t)}),e.forEach(this.removeInfo.bind(this))}},{key:"clean",value:function(){this.elementList.forEach(this.removeInfo.bind(this)),this.elementList=[]}},{key:"getElementList",value:function(t){return t?"string"==typeof t?[].slice.call(document.querySelectorAll(t)):"number"==typeof t.length?[].slice.call(t):[t]:[]}},{key:"initElement",value:function(t){this.attachInfo(t),this.setPlaceholder(t),this.updateElementClassByState("inited",t),this.invokeStateHook("inited",t)}},{key:"attachInfo",value:function(t){var e=this.options.infoGetter&&this.options.infoGetter(t),n=i({},e,{loading:!1});t[o]=n}},{key:"setPlaceholder",value:function(t){var e=t[o];"IMG"===t.nodeName&&e.width&&e.height&&(t.src=function(t,e){return["data:image/svg+xml;utf8,",'<?xml version="1.0"?>','<svg xmlns="http://www.w3.org/2000/svg" version="1.1" ','width="'+t+'" height="'+e+'"',"></svg>"].join("")}(e.width,e.height))}},{key:"removeInfo",value:function(t){t[o]&&(t[o]=null)}},{key:"updateState",value:function(){var t=this;if(this.elementList.length){var e=this.getActiveArea();this.elementList.forEach(function(n){var i=n[o].loading,s=n.getBoundingClientRect(),r=function(t,e){return!(e.bottom<t.top||e.top>t.bottom||e.right<t.left||e.left>t.right)}(e,s);!i&&r&&t.loadIamge(n)})}}},{key:"getActiveArea",value:function(){var t=this.getVisibleArea(),e=this.options.threshold||0;return{top:t.top-e,left:t.left-e,right:t.right+e,bottom:t.bottom+e}}},{key:"getVisibleArea",value:function(){if(this.options.visibleAreaGetter)return this.options.visibleAreaGetter();var t=function(){var t=document.documentElement;return{width:Math.max(t.clientWidth,window.innerWidth||0),height:Math.max(t.clientHeight,window.innerHeight||0)}}();return{top:0,left:0,right:t.width,bottom:t.height}}},{key:"loadIamge",value:function(t){var e=this,n=t[o],i=n.url;n.loading=!0,this.updateElementClassByState("loading",t),this.invokeStateHook("loading",t),function(t,e){var n=e.onStart,i=e.onLoaded,s=e.onError,o=new Image;o.onload=function(){i&&i(t,o)},o.onerror=function(){s&&s(t,o)},o.src=t,n&&n(t,o)}(i,{onStart:function(n,i){e.options.eagerShowing&&e.onMetaLoaded(i,function(){t.removeAttribute("src"),t.setAttribute("src",n)})},onLoaded:function(){e.setElementWithImageUrl(i,t),e.updateElementClassByState("loaded",t),e.invokeStateHook("loaded",t),e.removeElement(t)},onError:function(){e.updateElementClassByState("error",t),e.invokeStateHook("error",t),e.removeElement(t)}})}},{key:"updateElementClassByState",value:function(t,e){switch(t){case"inited":e.classList.add("inited"),e.classList.remove("loading"),e.classList.remove("loaded"),e.classList.remove("error");break;case"loading":e.classList.add("loading");break;case"loaded":e.classList.remove("loading"),e.classList.add("loaded");break;case"error":e.classList.remove("loading"),e.classList.add("error")}}},{key:"invokeStateHook",value:function(t,e){if(this.options.onStateChange){var n=e[o].url;this.options.onStateChange(t,n,e,this)}}},{key:"setElementWithImageUrl",value:function(t,e){"IMG"===e.nodeName?e.src=t:e.style.backgroundImage="url("+t+")"}},{key:"onMetaLoaded",value:function(e,n){var i=setInterval(function(){e.naturalWidth&&(s(),n())},300),s=function(){return clearInterval(i)};t(e,"load",s),t(e,"error",s)}},{key:"destroy",value:function(){this.removeEventListener(),this.clean(),this.setOptions({})}}]),r}()})},987:function(t,e,n){function i(t){n(988)}var s=n(25)(n(989),n(990),i,"data-v-defc1ee6",null);t.exports=s.exports},988:function(t,e){},989:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(37);e.default={data:function(){return{show:!1}},computed:{isWechat:function(){return Object(i.b)()}},filters:{},methods:{loginWithWechat:function(){return this.$getBean("oauthBusiness").loginWithWechat()},close:function(){this.show=!1},authoLogin:function(){this.show=!1,this.$requestLogin()}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.AUTH_WECHAT_QUICK_LOGIN,function(){t.isWechat?t.show=!0:t.$requestLogin()})}}},990:function(t,e,n){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.show?n("div",{staticClass:"wechat-quick-login"},[n("div",{staticClass:"quick-box"},[n("div",{staticClass:"header"},[n("div",{staticClass:"title"},[t._v("注册或登录后即可继续操作")]),n("i",{staticClass:"close-btn ion-close-round",attrs:{title:"关闭"},on:{click:t.close}})]),n("div",{staticClass:"auth-box"},[n("div",{staticClass:"auth-btn wx",on:{click:t.loginWithWechat}},[t._m(0),n("span",[t._v("微信快捷登录")])]),n("div",{staticClass:"auth-btn jj",on:{click:t.authoLogin}},[t._m(1),n("span",[t._v("掘金账号登录")])])])])]):t._e()},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",[i("img",{attrs:{src:n(991)}})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",[i("img",{attrs:{src:n(992)}})])}]}},991:function(t,e,n){t.exports=n.p+"static/img/wechat.5e2cfe7.svg"},992:function(t,e,n){t.exports=n.p+"static/img/icon.37ca4f6.svg"},993:function(t,e,n){function i(t){n(994)}var s=n(25)(n(995),n(1011),i,"data-v-73656c2d",null);t.exports=s.exports},994:function(t,e){},995:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n.n(i),o=(n(87),n(56),n(37)),r=n(996),a=n.n(r),c=n(1001),u=n.n(c),l=n(215);e.default={components:{PaymentQrCode:a.a,PaymentDialog:u.a},data:function(){return{paymentStep:"PaymentDialog",show:!1,info:{id:null,title:"",code:"",price:0}}},computed:{isMobileBrowser:function(){return Object(o.d)()},isWechat:function(){return Object(o.b)()},payWay:function(){return this.isWechat?l.c:this.isMobileBrowser?l.a:l.b}},methods:{close:function(){this.show=!1,this.paymentStep="PaymentDialog"},prev:function(){this.step("prev")},next:function(t){this.step("next",t)},step:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";"prev"===t&&(this.paymentStep="PaymentDialog"),"next"===t&&(this.$getBean("xiaoceBusiness").storagePaymengtStatus(this.payWay),this.info.code=e,this.payWay===l.b?this.paymentStep="PaymentQrCode":this.$getBean("xiaoceBusiness").toAppPay({way:this.payWay,id:this.info.id,code:e}))}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.BOOK_PAYMENT,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.show=!0,t.info=s()({},e)})},beforeDestroy:function(){}}},996:function(t,e,n){function i(t){n(997)}var s=n(25)(n(998),n(999),i,"data-v-04efeccb",null);t.exports=s.exports},997:function(t,e){},998:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(825),s=n(215);e.default={props:["info"],data:function(){return{payQrCode:"",checkTimer:null}},methods:{prev:function(){this.$emit("prev")},buyBook:function(){var t=this,e=this.info,n=e.id,s=e.code;this.$getBean("xiaoceBusiness").getWechatPayQrCode({id:n,code:s}).then(function(e){t.payQrCode=Object(i.a)(e),t.$nextTick(function(){t.checkBuyBook()})})},closePayment:function(){clearTimeout(this.closeTimer)},cancelCheckPay:function(){clearInterval(this.checkTimer)},checkBuyBook:function(){var t=this,e=this.info.id;this.checkTimer=setInterval(function(){t.$getBean("xiaoceBusiness").checkBuyBook(e).then(function(n){1===n&&(t.cancelCheckPay(),t.$emit("close"),window.location.href="/book/"+e+"?paymentStatus="+s.b)})},4e3),this.closeTimer=setTimeout(function(){t.cancelCheckPay(),t.$emit("close"),t.$alert("交易关闭")},3e5)}},beforeDestroy:function(){this.closePayment(),this.cancelCheckPay()},mounted:function(){this.buyBook()}}},999:function(t,e,n){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"payment-qr-code"},[n("div",{staticClass:"heading"},[n("div",{staticClass:"back",on:{click:t.prev}}),n("div",{staticClass:"title"},[t._v(t._s(t.info.title))])]),n("div",{staticClass:"qr-img"},[n("img",{attrs:{src:t.payQrCode}})]),t._m(0)])},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"bottom"},[i("img",{attrs:{src:n(1e3)}}),i("span",[t._v("微信扫码支付")])])}]}}});