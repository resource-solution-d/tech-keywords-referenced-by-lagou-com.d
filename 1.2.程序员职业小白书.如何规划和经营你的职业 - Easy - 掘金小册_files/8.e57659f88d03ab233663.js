webpackJsonp([8],{1e3:function(t,e,i){t.exports=i.p+"static/img/wx-pay.6a911dc.svg"},1001:function(t,e,i){function s(t){i(1002)}var n=i(25)(i(1003),i(1008),s,"data-v-6692af02",null);t.exports=n.exports},1002:function(t,e){},1003:function(t,e,i){"use strict";function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{hasSale:!1,realityPrice:null,code:"",discountRate:null};return{hasSale:t.hasSale,realityPrice:t.realityPrice,code:t.code,discountRate:t.discountRate}}Object.defineProperty(e,"__esModule",{value:!0});var n=i(1004),o=i.n(n),a=i(215);e.default={props:["info","payWay"],components:{Conpon:o.a},data:function(){return{aliPay:a.a,visibleConpon:!1,saleInfo:s()}},computed:{saleText:function(){var t=this.saleInfo.discountRate;return t>0?this.saleInfo.discountRate+"折":"免费"}},methods:{computeSale:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.visibleConpon=!1;var i=.01,n=isNaN(e)?1:10*e/100,o=n*this.info.price;0===o?i=0:(o=parseInt(100*o)/100,i=o>0?o.toFixed(2):.01),this.saleInfo=s({code:t,hasSale:!0,discountRate:e,realityPrice:i})},resetSaleInfo:function(){this.visibleConpon=!1,this.saleInfo=s({realityPrice:this.info.price})},close:function(){this.$emit("close")},next:function(){var t=this,e=this.saleInfo;e.hasSale;e.realityPrice>0?this.$emit("next",this.saleInfo.code):(this.$getBean("xiaoceBusiness").storagePaymengtStatus(this.payWay),this.$getBean("xiaoceBusiness").freeDiscount({metaId:this.info.id,type:this.payWay,code:this.saleInfo.code||""}).then(function(e){window.location.href="/book/"+t.info.id+"?paymentStatus="+t.payWay}))}},mounted:function(){this.saleInfo=s({realityPrice:this.info.price})}}},1004:function(t,e,i){function s(t){i(1005)}var n=i(25)(i(1006),i(1007),s,"data-v-bb1b3500",null);t.exports=n.exports},1005:function(t,e){},1006:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(37);e.default={data:function(){return{inputStatus:"",code:"",errorMsg:""}},props:["id"],computed:{isMobileBrowser:function(){return Object(s.d)()},conponClass:function(){return this.isMobileBrowser?"conpon-inner--"+this.inputStatus:""}},methods:{conponFocus:function(){this.inputStatus="focus"},conponBlur:function(){this.inputStatus="blur"},cancel:function(){this.$emit("close")},check:function(){var t=this,e=this.code.trim();this.$getBean("xiaoceBusiness").checkDiscount({metaId:this.id,code:e}).then(function(e){if(e.isOk){var i=e.discountRate;t.$emit("submit",t.code,i)}else t.errorMsg=e.message||"优惠码错误，请重新输入"})}},mounted:function(){this.$refs.saleInput.focus()}}},1007:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"conpon-wrap"},[i("div",{staticClass:"conpon-masker"}),i("div",{staticClass:"conpon-inner",class:t.conponClass},[i("div",{staticClass:"heading"},[t._v("请输入优惠码")]),i("div",{staticClass:"content"},[i("div",{staticClass:"conpon-input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.code,expression:"code"}],ref:"saleInput",attrs:{autofocus:"autofocus"},domProps:{value:t.code},on:{focus:t.conponFocus,blur:t.conponBlur,keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.check(e)},input:function(e){e.target.composing||(t.code=e.target.value)}}}),t.errorMsg?i("div",{staticClass:"state-text"},[t._v(t._s(t.errorMsg))]):t._e()])]),i("div",{staticClass:"footer"},[i("div",{staticClass:"btn cancel",on:{click:t.cancel}},[t._v("取消")]),i("div",{staticClass:"btn ok",on:{click:t.check}},[t._v("确定")])])])])},staticRenderFns:[]}},1008:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"payment-dialog"},[s("div",{staticClass:"cell"},[s("span",{staticClass:"close-btn",on:{click:t.close}}),s("div",{staticClass:"title"},[t._v(t._s(t.info.title))]),s("div",{staticClass:"price"},[s("span",{staticClass:"name"},[t._v("支付总额")]),t.saleInfo.hasSale?s("div",{staticClass:"price-sale"},[s("div",{staticClass:"span rmb"},[t._v("￥"+t._s(t.saleInfo.realityPrice))]),s("div",{staticClass:"span delete"},[t._v("￥"+t._s(t.info.price))])]):s("div",{staticClass:"price-default"},[s("div",{staticClass:"span rmb"},[t._v("￥"+t._s(t.info.price))])])]),s("div",{staticClass:"pay-way"},[s("span",{staticClass:"name"},[t._v("支付方式")]),t.payWay===t.aliPay?s("span",{staticClass:"ali-pay"},[s("img",{attrs:{src:i(1009)}}),t._v("支付宝支付")]):s("span",{staticClass:"wx-pay"},[s("img",{attrs:{src:i(1010)}})])]),s("div",{staticClass:"pay-sale",on:{click:function(e){t.visibleConpon=!0}}},[s("span",{staticClass:"name"},[t._v("使用优惠码")]),t.saleInfo.hasSale?t._e():s("span",{staticClass:"not-sale"},[t._v("输入优惠码")]),t.saleInfo.hasSale?s("span",{staticClass:"sale-box",on:{click:function(e){t.visibleConpon=!0}}},[t._v(t._s(t.saleText))]):t._e()]),s("div",{staticClass:"pay-bar"},[s("button",{staticClass:"button--buy",on:{click:t.next}},[t._v("确认支付")])])]),t.visibleConpon?s("conpon",{attrs:{id:t.info.id},on:{close:t.resetSaleInfo,submit:t.computeSale}}):t._e()],1)},staticRenderFns:[]}},1009:function(t,e,i){t.exports=i.p+"static/img/ali-pay-logo.a251946.png"},1010:function(t,e,i){t.exports=i.p+"static/img/wx-pay-logo.2a9abb4.png"},1011:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{staticClass:"payment-wrap"},[i("div",{staticClass:"payment-masker"}),i("div",{staticClass:"payment-inner"},[i("transition",{attrs:{name:"fade",mode:"out-in"}},[i(t.paymentStep,{tag:"component",attrs:{info:t.info,"pay-way":t.payWay},on:{close:t.close,prev:t.prev,next:t.next}})],1)],1)]):t._e()},staticRenderFns:[]}},1310:function(t,e){},1311:function(t,e){},1312:function(t,e){},1313:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(3),n=i.n(s),o=i(23),a=i.n(o),c=i(149),r=i.n(c),u=i(9),l=i(87),f=i(56),h=i(822),d=i(841),v=i(216),p=i.n(v),m=i(207),b=i.n(m),_=i(982),g=i.n(_),y=i(987),k=i.n(y),C=i(993),B=i.n(C),I=i(922),x=i.n(I),w=i(1314),$=i.n(w),L=i(1319),S=i.n(L);e.default={components:{Avatar:b.a,Books:g.a,BookBoughtListModal:x.a,BookPaymentPopup:B.a,BookGuidanceJoinWechat:S.a,WechatQuickLogin:k.a,BookDirectory:$.a},data:function(){return{bookInfo:null,bookList:[],sectionList:[],isViewNavOnTop:!1,fixedBuyShow:!1,queryBuyList:{pageNum:1,pageSize:20},likeLock:Object(h.a)(),boughtUsers:[],isBookBoughtListVisible:!1,isBookBoughtGuideVisible:!1,bookBoughtId:null,actionItem:{more:{active:!1}}}},computed:r()({},Object(l.mapGetters)({logined:u.LOGINED,user:u.USER}),{isAdmin:function(){return"admin"===(this.user||{}).role},isEditor:function(){var t=this.user||{};return this.author.uid===t.id},isXiaoceAuthor:function(){var t=this.user||{},e="admin"===t.role;return t.isXiaoceAuthor||e},freeSectionList:function(){return this.sectionList.filter(function(t){return t.isFree&&t.isFinished})},hasFreeSection:function(){return!this.free&&this.freeSectionList.length>0},free:function(){var t=this.bookInfo,e=t.price,i=t.isBuy,s=t.isEditor;return 0===e||i||s},notFree:function(){return this.bookInfo.price>0},bookId:function(){return this.$route.params.id},author:function(){var t=this.bookInfo;return t&&t.user||{}}}),watch:{$route:function(){this.fetch()}},shareInfo:function(){var t=this.bookInfo||{};return{title:t.title+" - "+this.author.username+" - 掘金小册",noTemplate:!0,description:t.desc,thumb:t.img,url:this.$route.fullPath}},metaInfo:function(){var t=this.bookInfo&&this.bookInfo.title||"",e=this.author.username;return t=t?t+" - ":"",e=e?e+" - ":"",{titleTemplate:null,title:""+t+e+"掘金小册"}},methods:{closeJoinWechat:function(){this.isBookBoughtGuideVisible=!1,this.$router.replace(this.$bookInfo(this.bookId))},toggleHot:function(){var t=this,e=!this.bookInfo.isHot,i=this.bookInfo.id;return this.$getBean("xiaoceBusiness").setXiaoceHot({id:i,isHot:e}).then(function(i){t.bookInfo.isHot=e}).catch(function(e){t.$alert(e)})},gotoEditView:function(t){window.open("/editor/book/"+t+"/section","_self")},toggleActivateActionItem:function(t){var e=this;a()(this.actionItem).forEach(function(i){e.actionItem[i].active=t===i&&!e.actionItem[i].active})},showBoughtList:function(){this.bookBoughtId=this.bookId,this.isBookBoughtListVisible=!0},hideBookBoughtList:function(){this.bookBoughtId=null,this.isBookBoughtListVisible=!1},routeBookSection:function(){this.$router.push({name:"bookSection",params:{id:this.bookId}})},routeFreeBookSectoin:function(){var t=this.freeSectionList[0].sectionId||"";this.$router.push({name:"bookSection",params:{id:this.bookId,sectionId:t}})},setXiaoceInfoView:function(){this.$getBean("xiaoceBusiness").setXiaoceInfoView(this.bookId).then(function(t){}).catch(function(){})},getXiaoce:function(){this.getXiaoceById(),this.getListSection(),this.setXiaoceInfoView(),this.getListBuy()},getListBuy:function(){var t=this;this.$getBean("xiaoceBusiness").getListBuy(n()(this.queryBuyList,{id:this.bookId})).then(function(e){t.boughtUsers=e}).catch(function(){})},getXiaoceById:function(){var t=this;return this.$getBean("xiaoceBusiness").getXiaoceById(this.bookId).then(function(e){t.bookInfo=e,t.recordPaymentType(),t.$nextTick(function(){t.zoomImages()})})},recordPaymentType:function(){var t=window.sessionStorage,e=t.getItem("paymentStatus"),i=this.$route.query.paymentStatus;e&&e===i&&(this.$getBean("xiaoceRecordBusiness").recordXiaoceBuy(e),this.isBookBoughtGuideVisible=!0,t.removeItem("paymentStatus"))},zoomImages:function(){var t=this;this.imageViewer=new p.a(this.$refs.poster,{urlHandler:function(t){return t.split("?")[0]+"?imageslim"},backgroundColor:"rgba(0,0,0,.65)",margin:50}),this.removeScrollListener=Object(f.e)(document,function(e){t.imageViewer.hide()})},getListSection:function(){var t=this;this.$getBean("xiaoceBusiness").getListSection(this.bookId).then(function(e){t.sectionList=e})},verifyBuyBook:function(){var t=this.$getBean("eventBus");this.logined?this.buyBook():t.emit(t.eventType.AUTH_WECHAT_QUICK_LOGIN)},buyBook:function(){var t=this.$getBean("eventBus"),e=this.bookInfo,i=e.id,s=e.title,n=e.price;t.emit(t.eventType.BOOK_PAYMENT,{id:i,title:s,price:n})},linkSection:function(t){var e="/book/"+this.bookId+"/section/"+t;window.open(e,"_self")},fetch:function(){this.getXiaoce(),this.getBooks()},getBooks:function(){var t=this;this.$getBean("xiaoceBusiness").getListByLastTime({pageNum:1}).then(function(e){"array"===Object(d.a)(e)&&(t.bookList=e.filter(function(e){return e.id!==t.bookId}).slice(0,6))})},reset:function(){}},preFetch:function(t){},mounted:function(){var t=this,e=this.$getBean("eventBus");this.fetch(),this.removeScrollListener=Object(f.e)(window,function(){window.pageYOffset<400?t.fixedBuyShow=!1:t.fixedBuyShow=!0},10);var i=this.$route.query.utm_source||"";this.$getBean("xiaoceRecordBusiness").recordXiaoceView(i),e.onVmLife(this,e.eventType.ROOT_CONTAINER_CLICK,function(){a()(t.actionItem).forEach(function(e){t.actionItem[e].active=!1})})},beforeDestroy:function(){this.reset(),this.removeScrollListener(),this.imageViewer&&this.imageViewer.destroy()}}},1314:function(t,e,i){function s(t){i(1315),i(1316)}var n=i(25)(i(1317),i(1318),s,"data-v-88c4b036",null);t.exports=n.exports},1315:function(t,e){},1316:function(t,e){},1317:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["info","free","admin","list"],data:function(){return{defaultText:"小册章节标题"}},computed:{bookId:function(){return this.$route.params.id},tryRead:function(){var t=this.info,e=t.price,i=t.isBuy;return!(0===e)&&this.admin||!i}},filters:{f_duration:function(t){t=t||0;var e=t/12/60,i=Math.floor(e),s=Math.round(e),n="分",o="";return i===s&&0!==i?(n+="30秒",o=i):o=s,o>1?o+n:1+n}},methods:{setFreeSection:function(t,e){this.$emit("setFreeSection",t,e)},routeSectionId:function(t){var e=t.isFree,i=t.sectionId,s=t.isFinished;s=void 0!==s&&s,(this.info.isFinished||s||this.admin)&&(this.free||e)&&this.$emit("linkSection",i)}},mounted:function(){}}},1318:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"section-menu section-of-info"},t._l(t.list,function(e,s){return i("div",{key:s,staticClass:"section",class:{"section-link":t.free||e.isFree},on:{click:function(i){t.routeSectionId(e)}}},[i("div",{staticClass:"step"},[i("div",{staticClass:"step-btn"},[t._v(t._s(s+1))])]),i("div",{staticClass:"center"},[i("div",{staticClass:"title"},[t._v(t._s(e.title||t.defaultText))]),i("div",{staticClass:"sub-line"},[e.isFree&&t.tryRead?i("div",{staticClass:"to-read"},[t._v("试读")]):t._e(),t.info.isFinished||e.isFinished?t._e():i("div",{staticClass:"writing"},[t._v("写作中")]),i("div",{staticClass:"statistics"},[t.info.isFinished||e.isFinished?i("span",{staticClass:"duration"},[t._v("时长: "+t._s(t._f("f_duration")(e.contentSize)))]):t._e(),e.isFinished&&e.pv?i("span",{staticClass:"readed"},[t._v(t._s(e.pv)+"次学习")]):t._e(),e.commentCount?i("span",{staticClass:"comment"},[t._v(t._s(e.commentCount)+"条评论")]):t._e()])])])])}))},staticRenderFns:[]}},1319:function(t,e,i){function s(t){i(1320)}var n=i(25)(i(1321),i(1323),s,"data-v-7023f514",null);t.exports=n.exports},1320:function(t,e){},1321:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(1322);e.default={data:function(){return{qrImg:s}},methods:{close:function(){this.$emit("close")}},mounted:function(){}}},1322:function(t,e,i){t.exports=i.p+"static/img/qr-img.e02494b.png"},1323:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"masker"},[i("div",{staticClass:"box"},[i("div",{staticClass:"title"},[t._v("扫描二维码入群与作者互动交流")]),i("div",{staticClass:"qr-box"},[i("img",{attrs:{src:t.qrImg}})]),i("button",{staticClass:"btn-read",on:{click:t.close}},[t._v("开始阅读")])])])},staticRenderFns:[]}},1324:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view-container",[t.bookInfo?s("div",{staticClass:"book-info-view"},[s("div",{staticClass:"book-box"},[s("div",{staticClass:"book-info"},[s("div",{ref:"poster",staticClass:"poster"},[t.bookInfo.img?s("img",{attrs:{src:t.bookInfo.img}}):t._e()]),s("div",{staticClass:"info"},[s("div",{staticClass:"title-line"},[s("router-link",{staticClass:"title",attrs:{to:t.$bookSection(t.bookId)}},[t.bookInfo.isFinished?t._e():s("div",{staticClass:"presale"},[t._v("预售")]),s("span",[t._v(t._s(t.bookInfo.title))])])],1),s("div",{staticClass:"media"},[s("div",{staticClass:"desc"},[t._v(t._s(t.bookInfo.desc))]),s("div",{staticClass:"author"},[s("div",{staticClass:"author-info"},[s("app-link",{staticClass:"user",attrs:{to:t.$userRoute(t.author),blank:!0,"st:name":"author","st:state":t.author.id}},[s("img",{staticClass:"hero",attrs:{src:t.author.avatar}}),s("span",[t._v(t._s(t.author.username))])])],1),s("div",{staticClass:"author-desc"},[s("span",{staticClass:"desc"},[t._v(t._s(t.author.selfDescription))])])])]),s("div",{staticClass:"other"},[s("div",{staticClass:"is-buy"},[t.free?s("button",{staticClass:"button--buy",on:{click:t.routeBookSection}},[t._v("立即阅读")]):t._e()]),s("div",{staticClass:"not-buy"},[t.free?t._e():s("button",{staticClass:"button--buy",on:{click:t.verifyBuyBook}},[t._v("购买 ￥"+t._s(t.bookInfo.price))]),t.hasFreeSection?s("button",{staticClass:"button--write",on:{click:t.routeFreeBookSectoin}},[t._v("试读")]):t._e()]),t.isAdmin||t.isEditor?s("div",{staticClass:"more",class:{open:t.actionItem.more.active},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.toggleActivateActionItem("more")}}},[s("img",{attrs:{src:i(1325)}}),s("ul",{staticClass:"more-list"},[s("li",{staticClass:"item",on:{click:function(e){t.gotoEditView(t.bookInfo.id)}}},[t._v("编辑")]),t.isAdmin?s("li",{staticClass:"item",on:{click:t.toggleHot}},[t._v(t._s(t.bookInfo.isHot?"取消推荐":"推荐到首页"))]):t._e()])]):t._e()])])]),s("div",{staticClass:"book-bought",on:{click:t.showBoughtList}},[s("div",{staticClass:"label"},[s("img",{attrs:{src:i(1326)}}),s("span",[t._v(t._s(t.bookInfo.buyCount)+" 人已购买")])]),s("div",{staticClass:"users"},t._l(t.boughtUsers,function(t,e){return s("avatar",{key:e,staticClass:"user",attrs:{user:t}})}))]),s("div",{staticClass:"book-mobile-other"},[t.free?s("button",{staticClass:"button--buy",on:{click:t.routeBookSection}},[t._v("立即阅读")]):t._e(),t.hasFreeSection?s("button",{staticClass:"button--write",on:{click:t.routeFreeBookSectoin}},[t._v("免费试读")]):t._e(),t.free?t._e():s("button",{staticClass:"button--buy",on:{click:t.verifyBuyBook}},[t._v("购买 ￥"+t._s(t.bookInfo.price))])]),s("div",{staticClass:"book-content"},[s("div",{staticClass:"book-content-head"},[t._v("小册内容")]),s("book-directory",{staticClass:"book-conte-directory",attrs:{free:t.free,info:t.bookInfo,admin:t.isAdmin||t.isEditor,list:t.sectionList},on:{linkSection:t.linkSection}})],1),s("div",{staticClass:"book-section-view"},[s("div",{staticClass:"entry-content",domProps:{innerHTML:t._s(t.bookInfo.summaryHtml)}})])]),s("div",{staticClass:"books-other"},[s("div",{staticClass:"header"},[t._v("推荐更多小册")]),t._l(t.bookList,function(e,i){return s("books",{key:i,attrs:{info:e},on:{showBoughtList:t.showBoughtList}})})],2),!t.free&&t.fixedBuyShow?s("div",{staticClass:"bottom-mobile-buy",on:{click:t.verifyBuyBook}},[t._v("购买 ￥"+t._s(t.bookInfo.price))]):t._e()]):t._e(),t.bookInfo?s("div",{staticClass:"copy-right"},[t._v("©"+t._s((new Date).getFullYear())+" 掘金")]):t._e(),t.isBookBoughtListVisible?s("book-bought-list-modal",{staticClass:"book-bought-list-modal",attrs:{id:t.bookBoughtId},on:{close:t.hideBookBoughtList}}):t._e(),s("wechat-quick-login"),s("book-payment-popup"),t.isBookBoughtGuideVisible?s("book-guidance-join-wechat",{on:{close:t.closeJoinWechat}}):t._e()],1)},staticRenderFns:[]}},1325:function(t,e,i){t.exports=i.p+"static/img/more.4e6dd54.svg"},1326:function(t,e,i){t.exports=i.p+"static/img/buy-icon.1323aad.svg"},787:function(t,e,i){function s(t){i(1310),i(1311),i(1312)}var n=i(25)(i(1313),i(1324),s,"data-v-55a4e6c5",null);t.exports=n.exports},822:function(t,e,i){"use strict";function s(){return new l}e.a=s;var n=i(5),o=i.n(n),a=i(0),c=i.n(a),r=i(1),u=i.n(r),l=function(){function t(){c()(this,t),this.busy=!1}return u()(t,[{key:"do",value:function(t){var e=this;return this.busy?o.a.resolve():(this.busy=!0,o.a.resolve("function"==typeof t?t():t).then(function(t){return e.busy=!1,t}).catch(function(t){return e.busy=!1,o.a.reject(t)}))}}]),t}()},823:function(t,e,i){function s(t){i(826)}var n=i(25)(i(827),i(828),s,"data-v-009ea7bb",null);t.exports=n.exports},825:function(t,e,i){"use strict";function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000000",i=new o.a({content:t,color:e,padding:0,width:410,height:410,background:"#ffffff",ecl:"L"}).svg();return"data:image/svg+xml;utf8,"+encodeURIComponent(i)}e.a=s;var n=i(211),o=i.n(n)},826:function(t,e){},827:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(57),n=i(208),o=i(209),a=i.n(o);e.default={components:{Lazy:a.a},props:["url","default","quality","width","height","shrink","format","size","alt","blank"],computed:{defaultThumbUrl:function(){return this.default||s.d},thumbUrl:function(){var t=this.url||(this.blank?"":this.defaultThumbUrl);return this.shrink?Object(n.b)(t,this.width,this.height,{format:this.format,quality:this.quality}):Object(n.a)(t,this.width,this.height,{format:this.format,quality:this.quality})},thumbStyle:function(){return{backgroundSize:this.size||"cover"}}}}},828:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("lazy",{staticClass:"thumb",style:t.thumbStyle,attrs:{div:!0,url:t.thumbUrl}})},staticRenderFns:[]}},841:function(t,e,i){"use strict";function s(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}e.a=s},922:function(t,e,i){function s(t){i(930)}var n=i(25)(i(931),i(936),s,"data-v-215ad105",null);t.exports=n.exports},930:function(t,e){},931:function(t,e,i){"use strict";function s(){return{query:{pageSize:20,pageNum:1},list:[],canFetchMore:!1,requestToken:null}}Object.defineProperty(e,"__esModule",{value:!0});var n=i(3),o=i.n(n),a=i(90),c=i(56),r=i(932),u=i.n(r);e.default={components:{User:u.a},props:["id"],data:s,computed:{title:function(){return"已购列表"}},watch:{type:function(){this.reset(),this.fetch()}},methods:{close:function(){this.$emit("close")},getListBuy:function(){var t=this.id;return this.$getBean("xiaoceBusiness").getListBuy(o()(this.query,{id:t}))},getMoreListBuy:function(){var t=this;this.canFetchMore&&(this.query.pageNum+=1,this.canFetchMore=!1,this.getListBuy().then(function(e){t.list=t.list.concat(e),t.$nextTick(function(){t.canFetchMore=!0})}).catch(function(){t.query.pageNum-=1,t.canFetchMore=!0}))},init:function(){var t=this;this.getListBuy().then(function(e){t.list=e,t.$nextTick(function(){t.canFetchMore=!0})})},reset:function(){o()(this,s())}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.emit(e.eventType.LOCK_ROOT_CONTAINER_SCROLL),this.removeKeyEventListener=Object(c.c)(document,"keyup",function(e){27===e.keyCode&&t.close()});var i=Object(a.a)(function(){t.getMoreListBuy()},500);Object(c.e)(this.$refs.list,i.bind(this)),Object(c.d)(this.$refs.list,i.bind(this)),this.init()},beforeDestroy:function(){var t=this.$getBean("eventBus");t.emit(t.eventType.UNLOCK_ROOT_CONTAINER_SCROLL),this.removeKeyEventListener()}}},932:function(t,e,i){function s(t){i(933)}var n=i(25)(i(934),i(935),s,"data-v-27a3294e",null);t.exports=n.exports},933:function(t,e){},934:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),n=i(822),o=i(207),a=i.n(o);e.default={components:{Avatar:a.a},props:["user"],data:function(){return{followLock:Object(n.a)()}},computed:{username:function(){return this.user.username},intro:function(){return this.$userPosition(this.user)||this.user.self_description},followed:function(){return this.user.followed},self:function(){return this.user.self}},methods:{toggleFollow:function(){var t=this;this.followLock.do(function(){return t.$ensureAuthorized().then(function(){return t.$store.dispatch(s.TOGGLE_FOLLOW_USER,t.user)}).catch(function(){})})}}}},935:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"user"},[i("router-link",{attrs:{to:t.$userRoute(t.user)}},[i("avatar",{staticClass:"avatar",attrs:{user:t.user}})],1),i("div",{staticClass:"user-info"},[i("router-link",{attrs:{to:t.$userRoute(t.user)}},[i("div",{staticClass:"username"},[t._v(t._s(t.username))])]),i("div",{staticClass:"intro"},[t._v(t._s(t.intro))])],1),i("router-view")],1)},staticRenderFns:[]}},936:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"related-user-list-modal"},[i("div",{staticClass:"close-btn",on:{click:t.close}},[i("i",{staticClass:"ion-close"})]),i("h1",{staticClass:"title"},[t._v(t._s(t.title))]),i("ul",{ref:"list",staticClass:"user-list"},t._l(t.list,function(t){return i("li",{staticClass:"item"},[i("user",{attrs:{user:t}})],1)}))])},staticRenderFns:[]}},982:function(t,e,i){function s(t){i(983)}var n=i(25)(i(984),i(985),s,"data-v-37aa673d",null);t.exports=n.exports},983:function(t,e){},984:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(23),n=i.n(s),o=i(3),a=i.n(o),c=i(149),r=i.n(c),u=i(9),l=i(87),f=i(823),h=i.n(f);e.default={props:["info"],data:function(){return{actionItem:{more:{active:!1}}}},components:{Thumb:h.a},computed:r()({},Object(l.mapGetters)({user:u.USER}),{isAdmin:function(){var t=this.user||{},e="admin"===t.role,i=this.author.uid===t.id;return e||i},author:function(){var t={},e=this.info.userData;return e&&(t=a()(e,{id:e.objectId})),t}}),filters:{f_bookInfo:function(t){return{name:"bookInfo",params:{id:t.id}}},f_duration:function(t){t=t||0;var e=t/12/60,i=Math.floor(e),s=Math.round(e),n="分",o="";return i===s&&0!==i?(n+="30秒",o=i):o=s,o>1?o+n:1+n},f_background:function(t){var e={};return t&&(e={"background-image":"url("+t+")","background-size":"cover"}),e}},methods:{toggleHot:function(){var t=this,e=!this.info.isHot,i=this.info.id;return this.$getBean("xiaoceBusiness").setXiaoceHot({id:i,isHot:e}).then(function(i){t.info.isHot=e}).catch(function(e){t.$alert(e)})},toggleActivateActionItem:function(t){var e=this;n()(this.actionItem).forEach(function(i){e.actionItem[i].active=t===i&&!e.actionItem[i].active})},gotoEditView:function(t){window.open("/editor/book/"+t+"/section","_self")},showBoughtList:function(t){this.$emit("showBoughtList",t)}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.ROOT_CONTAINER_CLICK,function(){n()(t.actionItem).forEach(function(e){t.actionItem[e].active=!1})})}}},985:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("app-link",{staticClass:"item",attrs:{tag:"div",to:t._f("f_bookInfo")(t.info),blank:!0}},[s("div",{staticClass:"poster"},[s("thumb",{staticClass:"poster-img",attrs:{alt:"小册封面图",url:t.info.img,quality:95,width:200,height:280}})],1),s("div",{staticClass:"info"},[s("div",{staticClass:"title"},[t.info.isFinished?t._e():s("span",{staticClass:"presale"},[t._v("预售")]),s("span",[t._v(t._s(t.info.title))])]),s("div",{staticClass:"desc"},[t._v(t._s(t.info.desc))]),s("div",{staticClass:"author"},[s("div",{staticClass:"author-info"},[s("app-link",{staticClass:"user",attrs:{to:t.$userRoute(t.author),blank:!0,"st:name":"author","st:state":t.author.id}},[s("div",{staticClass:"hero",style:t._f("f_background")(t.author.avatarLarge)}),s("span",[t._v(t._s(t.author.username))])])],1),s("div",{staticClass:"author-desc"},[s("span",{staticClass:"selfDescription"},[t._v(t._s(t.author.selfDescription))])])]),s("div",{staticClass:"other"},[!t.info.isBuy&&t.info.price>0?s("div",{staticClass:"price"},[t._v("￥"+t._s(t.info.price))]):t._e(),t.info.isBuy||0!==t.info.price?t._e():s("div",{staticClass:"price"},[t._v("免费")]),t.info.isBuy?s("div",{staticClass:"price bought"},[t._v("已购买")]):t._e(),s("div",{staticClass:"messages"},[s("span",{staticClass:"message"},[s("span",[t._v(t._s(t.info.section.length)+"小节")])]),t.info.isFinished?s("span",{staticClass:"message read-duration"},[s("span",[t._v("阅读时长"+t._s(t._f("f_duration")(t.info.contentSize)))])]):t._e(),t.info.buyCount>0?s("span",{staticClass:"message",on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.showBoughtList(t.info)}}},[s("span",[t._v(t._s(t.info.buyCount))]),s("span",[t._v("人已购买")])]):t._e()]),t.isAdmin?s("div",{staticClass:"more",class:{open:t.actionItem.more.active},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.toggleActivateActionItem("more")}}},[s("img",{attrs:{src:i(986)}}),s("ul",{staticClass:"more-list"},[s("li",{staticClass:"item",on:{click:function(e){t.gotoEditView(t.info.id)}}},[t._v("编辑")]),s("li",{staticClass:"item",on:{click:t.toggleHot}},[t._v(t._s(t.info.isHot?"取消推荐":"推荐到首页"))])])]):t._e()])])])},staticRenderFns:[]}},986:function(t,e,i){t.exports=i.p+"static/img/more.4e6dd54.svg"},987:function(t,e,i){function s(t){i(988)}var n=i(25)(i(989),i(990),s,"data-v-defc1ee6",null);t.exports=n.exports},988:function(t,e){},989:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(37);e.default={data:function(){return{show:!1}},computed:{isWechat:function(){return Object(s.b)()}},filters:{},methods:{loginWithWechat:function(){return this.$getBean("oauthBusiness").loginWithWechat()},close:function(){this.show=!1},authoLogin:function(){this.show=!1,this.$requestLogin()}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.AUTH_WECHAT_QUICK_LOGIN,function(){t.isWechat?t.show=!0:t.$requestLogin()})}}},990:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{staticClass:"wechat-quick-login"},[i("div",{staticClass:"quick-box"},[i("div",{staticClass:"header"},[i("div",{staticClass:"title"},[t._v("注册或登录后即可继续操作")]),i("i",{staticClass:"close-btn ion-close-round",attrs:{title:"关闭"},on:{click:t.close}})]),i("div",{staticClass:"auth-box"},[i("div",{staticClass:"auth-btn wx",on:{click:t.loginWithWechat}},[t._m(0),i("span",[t._v("微信快捷登录")])]),i("div",{staticClass:"auth-btn jj",on:{click:t.authoLogin}},[t._m(1),i("span",[t._v("掘金账号登录")])])])])]):t._e()},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",[s("img",{attrs:{src:i(991)}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",[s("img",{attrs:{src:i(992)}})])}]}},991:function(t,e,i){t.exports=i.p+"static/img/wechat.5e2cfe7.svg"},992:function(t,e,i){t.exports=i.p+"static/img/icon.37ca4f6.svg"},993:function(t,e,i){function s(t){i(994)}var n=i(25)(i(995),i(1011),s,"data-v-73656c2d",null);t.exports=n.exports},994:function(t,e){},995:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(3),n=i.n(s),o=(i(87),i(56),i(37)),a=i(996),c=i.n(a),r=i(1001),u=i.n(r),l=i(215);e.default={components:{PaymentQrCode:c.a,PaymentDialog:u.a},data:function(){return{paymentStep:"PaymentDialog",show:!1,info:{id:null,title:"",code:"",price:0}}},computed:{isMobileBrowser:function(){return Object(o.d)()},isWechat:function(){return Object(o.b)()},payWay:function(){return this.isWechat?l.c:this.isMobileBrowser?l.a:l.b}},methods:{close:function(){this.show=!1,this.paymentStep="PaymentDialog"},prev:function(){this.step("prev")},next:function(t){this.step("next",t)},step:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";"prev"===t&&(this.paymentStep="PaymentDialog"),"next"===t&&(this.$getBean("xiaoceBusiness").storagePaymengtStatus(this.payWay),this.info.code=e,this.payWay===l.b?this.paymentStep="PaymentQrCode":this.$getBean("xiaoceBusiness").toAppPay({way:this.payWay,id:this.info.id,code:e}))}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.BOOK_PAYMENT,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.show=!0,t.info=n()({},e)})},beforeDestroy:function(){}}},996:function(t,e,i){function s(t){i(997)}var n=i(25)(i(998),i(999),s,"data-v-04efeccb",null);t.exports=n.exports},997:function(t,e){},998:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(825),n=i(215);e.default={props:["info"],data:function(){return{payQrCode:"",checkTimer:null}},methods:{prev:function(){this.$emit("prev")},buyBook:function(){var t=this,e=this.info,i=e.id,n=e.code;this.$getBean("xiaoceBusiness").getWechatPayQrCode({id:i,code:n}).then(function(e){t.payQrCode=Object(s.a)(e),t.$nextTick(function(){t.checkBuyBook()})})},closePayment:function(){clearTimeout(this.closeTimer)},cancelCheckPay:function(){clearInterval(this.checkTimer)},checkBuyBook:function(){var t=this,e=this.info.id;this.checkTimer=setInterval(function(){t.$getBean("xiaoceBusiness").checkBuyBook(e).then(function(i){1===i&&(t.cancelCheckPay(),t.$emit("close"),window.location.href="/book/"+e+"?paymentStatus="+n.b)})},4e3),this.closeTimer=setTimeout(function(){t.cancelCheckPay(),t.$emit("close"),t.$alert("交易关闭")},3e5)}},beforeDestroy:function(){this.closePayment(),this.cancelCheckPay()},mounted:function(){this.buyBook()}}},999:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"payment-qr-code"},[i("div",{staticClass:"heading"},[i("div",{staticClass:"back",on:{click:t.prev}}),i("div",{staticClass:"title"},[t._v(t._s(t.info.title))])]),i("div",{staticClass:"qr-img"},[i("img",{attrs:{src:t.payQrCode}})]),t._m(0)])},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bottom"},[s("img",{attrs:{src:i(1e3)}}),s("span",[t._v("微信扫码支付")])])}]}}});